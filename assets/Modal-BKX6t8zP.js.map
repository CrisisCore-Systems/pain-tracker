{"version":3,"file":"Modal-BKX6t8zP.js","sources":["../../src/design-system/components/Modal.tsx","../../src/hooks/useFocusTrap.ts"],"sourcesContent":["import React, { useEffect, useRef } from 'react';\r\nimport { X, AlertTriangle, CheckCircle, Info, AlertCircle } from 'lucide-react';\r\nimport { Button } from './Button';\r\nimport { Card, CardContent, CardHeader, CardTitle } from './Card';\r\nimport { cn } from '../utils';\r\nimport { useFocusTrap } from '../../hooks/useFocusTrap';\r\n\r\nexport type ModalSize = 'sm' | 'md' | 'lg' | 'xl' | 'full';\r\n\r\nexport interface ModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  title?: string;\r\n  children: React.ReactNode;\r\n  size?: ModalSize;\r\n  className?: string;\r\n  showCloseButton?: boolean;\r\n  closeOnBackdropClick?: boolean;\r\n  closeOnEscape?: boolean;\r\n  footer?: React.ReactNode;\r\n  headerClassName?: string;\r\n  contentClassName?: string;\r\n  footerClassName?: string;\r\n}\r\n\r\nconst sizeClasses = {\r\n  sm: 'max-w-md',\r\n  md: 'max-w-lg',\r\n  lg: 'max-w-2xl',\r\n  xl: 'max-w-4xl',\r\n  full: 'max-w-full mx-4',\r\n};\r\n\r\nexport function Modal({\r\n  isOpen,\r\n  onClose,\r\n  title,\r\n  children,\r\n  size = 'md',\r\n  className,\r\n  showCloseButton = true,\r\n  closeOnBackdropClick = true,\r\n  closeOnEscape = true,\r\n  footer,\r\n  headerClassName,\r\n  contentClassName,\r\n  footerClassName,\r\n}: ModalProps) {\r\n  const modalRef = useRef<HTMLDivElement>(null);\r\n  const trapRef = useFocusTrap(isOpen);\r\n  const originalBodyOverflowRef = useRef<string | null>(null);\r\n\r\n  useEffect(() => {\r\n    const handleEscape = (event: KeyboardEvent) => {\r\n      if (event.key === 'Escape' && closeOnEscape) {\r\n        onClose();\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      document.addEventListener('keydown', handleEscape);\r\n      if (originalBodyOverflowRef.current === null) {\r\n        originalBodyOverflowRef.current = document.body.style.overflow;\r\n      }\r\n      document.body.style.overflow = 'hidden';\r\n    }\r\n\r\n    return () => {\r\n      document.removeEventListener('keydown', handleEscape);\r\n      if (originalBodyOverflowRef.current !== null) {\r\n        document.body.style.overflow = originalBodyOverflowRef.current;\r\n        originalBodyOverflowRef.current = null;\r\n      }\r\n    };\r\n  }, [isOpen, onClose, closeOnEscape]);\r\n\r\n  useEffect(() => {\r\n    if (isOpen && modalRef.current) {\r\n      modalRef.current.focus();\r\n    }\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleBackdropClick = (event: React.MouseEvent) => {\r\n    if (event.target === event.currentTarget && closeOnBackdropClick) {\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      ref={trapRef as React.RefObject<HTMLDivElement>}\r\n      className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-in fade-in duration-200\"\r\n      onClick={handleBackdropClick}\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-labelledby={title ? 'modal-title' : undefined}\r\n      aria-describedby={children ? 'modal-description' : undefined}\r\n    >\r\n      <div\r\n        ref={modalRef}\r\n        className={cn(\r\n          'w-full bg-background rounded-lg shadow-xl animate-in zoom-in-95 duration-200',\r\n          sizeClasses[size],\r\n          className\r\n        )}\r\n        tabIndex={-1}\r\n        role=\"document\"\r\n      >\r\n        <Card className=\"border-0 shadow-none\">\r\n          {(title || showCloseButton) && (\r\n            <CardHeader\r\n              className={cn(\r\n                'flex flex-row items-center justify-between space-y-0 pb-4',\r\n                headerClassName\r\n              )}\r\n            >\r\n              {title && (\r\n                <CardTitle id=\"modal-title\" className=\"text-lg font-semibold\">\r\n                  {title}\r\n                </CardTitle>\r\n              )}\r\n              {showCloseButton && (\r\n                <Button\r\n                  variant=\"ghost\"\r\n                  size=\"sm\"\r\n                  onClick={onClose}\r\n                  className=\"h-8 w-8 p-0 hover:bg-muted\"\r\n                  aria-label=\"Close modal\"\r\n                >\r\n                  <X className=\"h-4 w-4\" />\r\n                </Button>\r\n              )}\r\n            </CardHeader>\r\n          )}\r\n\r\n          <CardContent className={cn('pt-0', contentClassName)} id=\"modal-description\">\r\n            {children}\r\n          </CardContent>\r\n\r\n          {footer && (\r\n            <div\r\n              className={cn('flex justify-end space-x-2 pt-4 border-t px-6 pb-6', footerClassName)}\r\n            >\r\n              {footer}\r\n            </div>\r\n          )}\r\n        </Card>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n// Specialized modal components\r\nexport type AlertType = 'success' | 'error' | 'warning' | 'info';\r\n\r\nexport interface AlertModalProps extends Omit<ModalProps, 'children'> {\r\n  type: AlertType;\r\n  message: string;\r\n  description?: string;\r\n  confirmText?: string;\r\n  cancelText?: string;\r\n  onConfirm?: () => void;\r\n  onCancel?: () => void;\r\n}\r\n\r\nconst alertIcons = {\r\n  success: CheckCircle,\r\n  error: AlertCircle,\r\n  warning: AlertTriangle,\r\n  info: Info,\r\n};\r\n\r\nconst alertColors: Record<AlertType, React.CSSProperties> = {\r\n  success: { color: 'rgb(var(--color-pain-none))' },\r\n  error: { color: 'rgb(var(--color-pain-extreme))' },\r\n  warning: { color: 'rgb(var(--color-pain-moderate))' },\r\n  info: { color: 'rgb(var(--color-chart-series-1))' },\r\n};\r\n\r\nexport function AlertModal({\r\n  type,\r\n  message,\r\n  description,\r\n  confirmText = 'OK',\r\n  cancelText = 'Cancel',\r\n  onConfirm,\r\n  onCancel,\r\n  onClose,\r\n  ...props\r\n}: AlertModalProps) {\r\n  const Icon = alertIcons[type];\r\n  const colorClass = alertColors[type];\r\n\r\n  const handleConfirm = () => {\r\n    onConfirm?.();\r\n    onClose();\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    onCancel?.();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      {...props}\r\n      onClose={onCancel ? handleCancel : onClose}\r\n      footer={\r\n        <div className=\"flex space-x-2\">\r\n          {onCancel && (\r\n            <Button variant=\"outline\" onClick={handleCancel}>\r\n              {cancelText}\r\n            </Button>\r\n          )}\r\n          <Button onClick={handleConfirm}>{confirmText}</Button>\r\n        </div>\r\n      }\r\n    >\r\n      <div className=\"flex items-start space-x-4\">\r\n        <div className={cn('flex-shrink-0 mt-0.5')} style={colorClass}>\r\n          <Icon className=\"h-6 w-6\" />\r\n        </div>\r\n        <div className=\"flex-1\">\r\n          <h3 className=\"text-lg font-medium text-foreground mb-2\">{message}</h3>\r\n          {description && <p className=\"text-muted-foreground\">{description}</p>}\r\n        </div>\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n\r\nexport interface ConfirmModalProps extends Omit<ModalProps, 'children'> {\r\n  message: string;\r\n  description?: string;\r\n  confirmText?: string;\r\n  cancelText?: string;\r\n  onConfirm: () => void;\r\n  onCancel?: () => void;\r\n  variant?: 'default' | 'destructive';\r\n}\r\n\r\nexport function ConfirmModal({\r\n  message,\r\n  description,\r\n  confirmText = 'Confirm',\r\n  cancelText = 'Cancel',\r\n  onConfirm,\r\n  onCancel,\r\n  onClose,\r\n  variant = 'default',\r\n  ...props\r\n}: ConfirmModalProps) {\r\n  const handleConfirm = () => {\r\n    onConfirm();\r\n    onClose();\r\n  };\r\n\r\n  const handleCancel = () => {\r\n    onCancel?.();\r\n    onClose();\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      {...props}\r\n      onClose={handleCancel}\r\n      footer={\r\n        <div className=\"flex space-x-2\">\r\n          <Button variant=\"outline\" onClick={handleCancel}>\r\n            {cancelText}\r\n          </Button>\r\n          <Button\r\n            variant={variant === 'destructive' ? 'destructive' : 'default'}\r\n            onClick={handleConfirm}\r\n          >\r\n            {confirmText}\r\n          </Button>\r\n        </div>\r\n      }\r\n    >\r\n      <div className=\"text-center\">\r\n        <h3 className=\"text-lg font-medium text-foreground mb-2\">{message}</h3>\r\n        {description && <p className=\"text-muted-foreground\">{description}</p>}\r\n      </div>\r\n    </Modal>\r\n  );\r\n}\r\n","import { useEffect, useRef } from 'react';\r\n\r\n/**\r\n * Custom hook to trap focus within a modal or dialog component\r\n * Ensures keyboard users can't tab out of the modal until it's closed\r\n *\r\n * @param isActive - Whether the focus trap is currently active\r\n * @returns ref - Ref to attach to the container element\r\n *\r\n * @example\r\n * ```tsx\r\n * function Modal({ isOpen, onClose }) {\r\n *   const trapRef = useFocusTrap(isOpen);\r\n *\r\n *   if (!isOpen) return null;\r\n *\r\n *   return (\r\n *     <div ref={trapRef} role=\"dialog\" aria-modal=\"true\">\r\n *       <button onClick={onClose}>Close</button>\r\n *       {/* Modal content *\\/}\r\n *     </div>\r\n *   );\r\n * }\r\n * ```\r\n */\r\nexport function useFocusTrap(isActive: boolean) {\r\n  const containerRef = useRef<HTMLElement>(null);\r\n  const previousActiveElement = useRef<HTMLElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (!isActive || !containerRef.current) return;\r\n\r\n    const container = containerRef.current;\r\n\r\n    // Store the element that had focus before the modal opened\r\n    previousActiveElement.current = document.activeElement as HTMLElement;\r\n\r\n    // Get all focusable elements within the container\r\n    const getFocusableElements = (): HTMLElement[] => {\r\n      const focusableSelectors = [\r\n        'a[href]',\r\n        'button:not([disabled])',\r\n        'textarea:not([disabled])',\r\n        'input:not([disabled])',\r\n        'select:not([disabled])',\r\n        '[tabindex]:not([tabindex=\"-1\"])',\r\n      ].join(', ');\r\n\r\n      return Array.from(container.querySelectorAll<HTMLElement>(focusableSelectors)).filter(el => {\r\n        // In jsdom there is no layout information (offsetParent is null), so rely on tabindex only\r\n        // For browser environments, this will still work since non-visible elements typically have\r\n        // tabIndex -1.\r\n        return el.tabIndex >= 0;\r\n      });\r\n    };\r\n\r\n    // Focus the first focusable element when modal opens\r\n    const focusableElements = getFocusableElements();\r\n    if (focusableElements.length > 0) {\r\n      // Small delay to ensure modal is rendered\r\n      setTimeout(() => {\r\n        focusableElements[0]?.focus();\r\n      }, 10);\r\n    }\r\n\r\n    // Handle Tab key to trap focus\r\n    const handleKeyDown = (e: KeyboardEvent) => {\r\n      if (e.key !== 'Tab') return;\r\n\r\n      const focusableElements = getFocusableElements();\r\n      if (focusableElements.length === 0) return;\r\n\r\n      const firstElement = focusableElements[0];\r\n      const lastElement = focusableElements[focusableElements.length - 1];\r\n\r\n      // Shift + Tab (backwards)\r\n      if (e.shiftKey) {\r\n        if (document.activeElement === firstElement) {\r\n          e.preventDefault();\r\n          lastElement.focus();\r\n        }\r\n      }\r\n      // Tab (forwards)\r\n      else {\r\n        if (document.activeElement === lastElement) {\r\n          e.preventDefault();\r\n          firstElement.focus();\r\n        }\r\n      }\r\n    };\r\n\r\n    // Add event listeners (listen on container and document for reliable tab capture\r\n    // in test environments that may not bubble key events the same way as browsers)\r\n    container.addEventListener('keydown', handleKeyDown);\r\n    document.addEventListener('keydown', handleKeyDown);\r\n\r\n    // As a fallback for environments that don't reliably bubble keydown events, trap\r\n    // focus using focusin: if focus moves outside the container, bring it back to the\r\n    // first focusable element.\r\n    const handleFocusIn = (e: FocusEvent) => {\r\n      const target = e.target as HTMLElement | null;\r\n      if (!container.contains(target)) {\r\n        const focusable = getFocusableElements();\r\n        if (focusable.length > 0) focusable[0].focus();\r\n      }\r\n    };\r\n    document.addEventListener('focusin', handleFocusIn);\r\n\r\n    // Cleanup function\r\n    return () => {\r\n  container.removeEventListener('keydown', handleKeyDown);\r\n  document.removeEventListener('keydown', handleKeyDown);\r\n  document.removeEventListener('focusin', handleFocusIn);\r\n\r\n      // Restore focus to the element that had focus before the modal opened\r\n      if (previousActiveElement.current) {\r\n        previousActiveElement.current.focus();\r\n      }\r\n    };\r\n  }, [isActive]);\r\n\r\n  return containerRef;\r\n}\r\n"],"names":["sizeClasses","sm","md","lg","xl","full","Modal","isOpen","onClose","title","children","size","className","showCloseButton","closeOnBackdropClick","closeOnEscape","footer","headerClassName","contentClassName","footerClassName","modalRef","useRef","trapRef","isActive","containerRef","previousActiveElement","useEffect","current","container","document","activeElement","getFocusableElements","focusableSelectors","join","Array","from","querySelectorAll","filter","el","tabIndex","focusableElements","length","setTimeout","focus","handleKeyDown","e","key","firstElement","lastElement","shiftKey","preventDefault","addEventListener","handleFocusIn","target","contains","focusable","removeEventListener","useFocusTrap","originalBodyOverflowRef","handleEscape","event","body","style","overflow","jsxDEV","ref","onClick","currentTarget","role","cn","Card","CardHeader","CardTitle","id","fileName","lineNumber","columnNumber","this","Button","variant","X","CardContent"],"mappings":"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"}