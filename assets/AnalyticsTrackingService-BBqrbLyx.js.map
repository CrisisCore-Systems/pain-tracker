{"version":3,"file":"AnalyticsTrackingService-BBqrbLyx.js","sources":["../../src/services/AnalyticsTrackingService.ts"],"sourcesContent":["/**\r\n * Analytics Tracking Service\r\n * \r\n * Centralizes all analytics event tracking for Pain Tracker.\r\n * Sends privacy-respecting aggregate data to Google Analytics.\r\n * \r\n * IMPORTANT: No PHI (Protected Health Information) is ever sent.\r\n * Only anonymized, aggregate metrics for product improvement.\r\n */\r\n\r\ndeclare global {\r\n  interface Window {\r\n    gtag?: (...args: unknown[]) => void;\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    dataLayer?: any[];\r\n  }\r\n}\r\n\r\n// Check if analytics is available\r\nfunction isAnalyticsEnabled(): boolean {\r\n  return typeof window !== 'undefined' && typeof window.gtag === 'function';\r\n}\r\n\r\n// Safe gtag wrapper\r\nfunction trackEvent(\r\n  eventName: string,\r\n  params: Record<string, string | number | boolean | undefined>\r\n): void {\r\n  if (!isAnalyticsEnabled()) return;\r\n  \r\n  try {\r\n    // Filter out undefined values\r\n    const cleanParams = Object.fromEntries(\r\n      Object.entries(params).filter(([, v]) => v !== undefined)\r\n    );\r\n    \r\n    window.gtag?.('event', eventName, cleanParams);\r\n  } catch (e) {\r\n    console.debug('[Analytics] Event tracking failed:', e);\r\n  }\r\n}\r\n\r\n// ============================================\r\n// PAIN ENTRY TRACKING\r\n// ============================================\r\n\r\nexport interface PainEntryAnalytics {\r\n  painLevel: number;\r\n  locationsCount?: number;\r\n  symptomsCount?: number;\r\n  triggersCount?: number;\r\n  symptoms?: string[];\r\n  triggers?: string[];\r\n  hasNotes?: boolean;\r\n  hasMedications?: boolean;\r\n  weather?: string;\r\n  severity?: 'mild' | 'moderate' | 'severe';\r\n  timeOfDay?: 'morning' | 'afternoon' | 'evening' | 'night';\r\n  dayOfWeek?: string;\r\n  entryMethod?: 'quick' | 'detailed' | 'voice';\r\n}\r\n\r\nexport function trackPainEntry(data: PainEntryAnalytics): void {\r\n  // Calculate derived values\r\n  const locationsCount = data.locationsCount ?? 0;\r\n  const symptomsCount = data.symptomsCount ?? (data.symptoms?.length ?? 0);\r\n  const triggersCount = data.triggersCount ?? (data.triggers?.length ?? 0);\r\n  const now = new Date();\r\n  const hour = now.getHours();\r\n  const timeOfDay = data.timeOfDay ?? (\r\n    hour < 6 ? 'night' : \r\n    hour < 12 ? 'morning' : \r\n    hour < 18 ? 'afternoon' : \r\n    hour < 22 ? 'evening' : 'night'\r\n  );\r\n  const dayOfWeek = data.dayOfWeek ?? now.toLocaleDateString('en-US', { weekday: 'long' }).toLowerCase();\r\n  \r\n  trackEvent('pain_entry_logged', {\r\n    pain_level_bucket: getPainBucket(data.painLevel),\r\n    severity: data.severity ?? getPainBucket(data.painLevel),\r\n    locations_count: Math.min(locationsCount, 10),\r\n    symptoms_count: Math.min(symptomsCount, 10),\r\n    triggers_count: Math.min(triggersCount, 10),\r\n    has_notes: data.hasNotes ?? false,\r\n    has_medications: data.hasMedications ?? false,\r\n    has_weather: !!data.weather,\r\n    time_of_day: timeOfDay,\r\n    day_of_week: dayOfWeek,\r\n    entry_method: data.entryMethod ?? 'detailed',\r\n  });\r\n}\r\n\r\nfunction getPainBucket(level: number): string {\r\n  if (level <= 2) return 'mild';\r\n  if (level <= 5) return 'moderate';\r\n  if (level <= 8) return 'severe';\r\n  return 'extreme';\r\n}\r\n\r\n// ============================================\r\n// WEATHER CORRELATION TRACKING\r\n// ============================================\r\n\r\nexport interface WeatherAnalytics {\r\n  temperature?: number;\r\n  condition?: string;\r\n  pressure?: number;\r\n  humidity?: number;\r\n  painLevel: number;\r\n}\r\n\r\nexport function trackWeatherCorrelation(data: WeatherAnalytics): void {\r\n  trackEvent('weather_correlation', {\r\n    temp_bucket: data.temperature !== undefined ? getTempBucket(data.temperature) : undefined,\r\n    condition: data.condition,\r\n    pressure_bucket: data.pressure !== undefined ? getPressureBucket(data.pressure) : undefined,\r\n    humidity_bucket: data.humidity !== undefined ? getHumidityBucket(data.humidity) : undefined,\r\n    pain_level_bucket: getPainBucket(data.painLevel),\r\n  });\r\n}\r\n\r\nfunction getTempBucket(temp: number): string {\r\n  if (temp < 0) return 'freezing';\r\n  if (temp < 10) return 'cold';\r\n  if (temp < 20) return 'mild';\r\n  if (temp < 30) return 'warm';\r\n  return 'hot';\r\n}\r\n\r\nfunction getPressureBucket(pressure: number): string {\r\n  if (pressure < 1000) return 'low';\r\n  if (pressure < 1020) return 'normal';\r\n  return 'high';\r\n}\r\n\r\nfunction getHumidityBucket(humidity: number): string {\r\n  if (humidity < 30) return 'dry';\r\n  if (humidity < 60) return 'comfortable';\r\n  return 'humid';\r\n}\r\n\r\n// ============================================\r\n// MOOD & QUALITY OF LIFE TRACKING\r\n// ============================================\r\n\r\nexport interface MoodAnalytics {\r\n  moodScore: number;\r\n  sleepQuality?: number;\r\n  stressLevel?: number;\r\n  energyLevel?: number;\r\n}\r\n\r\nexport function trackMoodEntry(data: MoodAnalytics): void {\r\n  trackEvent('mood_entry_logged', {\r\n    mood_bucket: getMoodBucket(data.moodScore),\r\n    sleep_bucket: data.sleepQuality !== undefined ? getQualityBucket(data.sleepQuality) : undefined,\r\n    stress_bucket: data.stressLevel !== undefined ? getStressBucket(data.stressLevel) : undefined,\r\n    energy_bucket: data.energyLevel !== undefined ? getQualityBucket(data.energyLevel) : undefined,\r\n  });\r\n}\r\n\r\nfunction getMoodBucket(score: number): string {\r\n  if (score <= 2) return 'very_low';\r\n  if (score <= 4) return 'low';\r\n  if (score <= 6) return 'neutral';\r\n  if (score <= 8) return 'good';\r\n  return 'excellent';\r\n}\r\n\r\nfunction getQualityBucket(score: number): string {\r\n  if (score <= 3) return 'poor';\r\n  if (score <= 5) return 'fair';\r\n  if (score <= 7) return 'good';\r\n  return 'excellent';\r\n}\r\n\r\nfunction getStressBucket(score: number): string {\r\n  if (score <= 2) return 'low';\r\n  if (score <= 5) return 'moderate';\r\n  if (score <= 8) return 'high';\r\n  return 'severe';\r\n}\r\n\r\n// ============================================\r\n// ACTIVITY & EXERCISE TRACKING\r\n// ============================================\r\n\r\nexport interface ActivityAnalytics {\r\n  activityType: string;\r\n  durationMinutes: number;\r\n  intensityLevel?: number;\r\n  painBefore?: number;\r\n  painAfter?: number;\r\n}\r\n\r\nexport function trackActivityLog(data: ActivityAnalytics): void {\r\n  trackEvent('activity_logged', {\r\n    activity_type: data.activityType,\r\n    duration_bucket: getDurationBucket(data.durationMinutes),\r\n    intensity_bucket: data.intensityLevel !== undefined ? getIntensityBucket(data.intensityLevel) : undefined,\r\n    pain_change: data.painBefore !== undefined && data.painAfter !== undefined\r\n      ? getPainChange(data.painBefore, data.painAfter)\r\n      : undefined,\r\n  });\r\n}\r\n\r\nfunction getDurationBucket(minutes: number): string {\r\n  if (minutes < 15) return 'brief';\r\n  if (minutes < 30) return 'short';\r\n  if (minutes < 60) return 'moderate';\r\n  return 'extended';\r\n}\r\n\r\nfunction getIntensityBucket(level: number): string {\r\n  if (level <= 3) return 'light';\r\n  if (level <= 6) return 'moderate';\r\n  return 'intense';\r\n}\r\n\r\nfunction getPainChange(before: number, after: number): string {\r\n  const diff = after - before;\r\n  if (diff <= -2) return 'improved_significantly';\r\n  if (diff < 0) return 'improved';\r\n  if (diff === 0) return 'unchanged';\r\n  if (diff <= 2) return 'worsened';\r\n  return 'worsened_significantly';\r\n}\r\n\r\n// ============================================\r\n// MEDICATION TRACKING\r\n// ============================================\r\n\r\nexport interface MedicationAnalytics {\r\n  medicationType?: string;\r\n  effectiveness?: number;\r\n  sideEffects: boolean;\r\n}\r\n\r\nexport function trackMedicationLog(data: MedicationAnalytics): void {\r\n  trackEvent('medication_logged', {\r\n    medication_category: data.medicationType || 'unspecified',\r\n    effectiveness_bucket: data.effectiveness !== undefined \r\n      ? getEffectivenessBucket(data.effectiveness) \r\n      : undefined,\r\n    has_side_effects: data.sideEffects,\r\n  });\r\n}\r\n\r\nfunction getEffectivenessBucket(score: number): string {\r\n  if (score <= 2) return 'not_effective';\r\n  if (score <= 5) return 'somewhat_effective';\r\n  if (score <= 8) return 'effective';\r\n  return 'very_effective';\r\n}\r\n\r\n// ============================================\r\n// TRIGGER ANALYSIS TRACKING\r\n// ============================================\r\n\r\nexport interface TriggerAnalytics {\r\n  triggerCategory: string;\r\n  frequency: number;\r\n  averagePainIncrease: number;\r\n}\r\n\r\nexport function trackTriggerIdentified(data: TriggerAnalytics): void {\r\n  trackEvent('trigger_identified', {\r\n    trigger_category: data.triggerCategory,\r\n    frequency_bucket: getFrequencyBucket(data.frequency),\r\n    pain_impact: getPainImpactBucket(data.averagePainIncrease),\r\n  });\r\n}\r\n\r\nfunction getFrequencyBucket(count: number): string {\r\n  if (count <= 2) return 'rare';\r\n  if (count <= 5) return 'occasional';\r\n  if (count <= 10) return 'frequent';\r\n  return 'very_frequent';\r\n}\r\n\r\nfunction getPainImpactBucket(increase: number): string {\r\n  if (increase <= 1) return 'minimal';\r\n  if (increase <= 2) return 'moderate';\r\n  if (increase <= 3) return 'significant';\r\n  return 'severe';\r\n}\r\n\r\n// ============================================\r\n// PATTERN DETECTION TRACKING\r\n// ============================================\r\n\r\nexport interface PatternAnalytics {\r\n  patternType: 'time_of_day' | 'day_of_week' | 'weather' | 'activity' | 'medication' | 'sleep';\r\n  confidence: number;\r\n  correlationStrength: number;\r\n}\r\n\r\nexport function trackPatternDetected(data: PatternAnalytics): void {\r\n  trackEvent('pattern_detected', {\r\n    pattern_type: data.patternType,\r\n    confidence_bucket: getConfidenceBucket(data.confidence),\r\n    correlation_strength: getCorrelationBucket(data.correlationStrength),\r\n  });\r\n}\r\n\r\nfunction getConfidenceBucket(confidence: number): string {\r\n  if (confidence < 0.5) return 'low';\r\n  if (confidence < 0.75) return 'moderate';\r\n  return 'high';\r\n}\r\n\r\nfunction getCorrelationBucket(strength: number): string {\r\n  if (strength < 0.3) return 'weak';\r\n  if (strength < 0.6) return 'moderate';\r\n  return 'strong';\r\n}\r\n\r\n// ============================================\r\n// FEATURE USAGE TRACKING\r\n// ============================================\r\n\r\nexport function trackFeatureUsed(featureName: string, metadata?: Record<string, string | number | boolean>): void {\r\n  trackEvent('feature_used', {\r\n    feature_name: featureName,\r\n    ...metadata,\r\n  });\r\n}\r\n\r\nexport function trackExportGenerated(exportType: 'csv' | 'pdf' | 'json' | 'wcb', recordCount: number): void {\r\n  trackEvent('export_generated', {\r\n    export_type: exportType,\r\n    record_count_bucket: getRecordCountBucket(recordCount),\r\n  });\r\n}\r\n\r\nfunction getRecordCountBucket(count: number): string {\r\n  if (count <= 10) return 'small';\r\n  if (count <= 50) return 'medium';\r\n  if (count <= 200) return 'large';\r\n  return 'very_large';\r\n}\r\n\r\n// ============================================\r\n// CRISIS EVENT TRACKING\r\n// ============================================\r\n\r\nexport interface CrisisAnalytics {\r\n  severity: 'none' | 'mild' | 'moderate' | 'severe' | 'critical';\r\n  triggerTypes: string[];\r\n  autoActivatedEmergencyMode: boolean;\r\n  durationSeconds?: number;\r\n  resolutionMethod?: string;\r\n}\r\n\r\nexport function trackCrisisDetected(severity: string): void {\r\n  trackEvent('crisis_detected', {\r\n    severity_level: severity,\r\n  });\r\n}\r\n\r\nexport function trackCrisisEvent(data: CrisisAnalytics): void {\r\n  trackEvent('crisis_event', {\r\n    severity: data.severity,\r\n    trigger_count: data.triggerTypes.length,\r\n    trigger_types: data.triggerTypes.join(','),\r\n    auto_emergency_mode: data.autoActivatedEmergencyMode,\r\n    duration_bucket: data.durationSeconds !== undefined \r\n      ? getCrisisDurationBucket(data.durationSeconds) \r\n      : undefined,\r\n    resolution_method: data.resolutionMethod,\r\n  });\r\n}\r\n\r\nfunction getCrisisDurationBucket(seconds: number): string {\r\n  if (seconds < 60) return 'brief';\r\n  if (seconds < 300) return 'short';\r\n  if (seconds < 900) return 'moderate';\r\n  return 'extended';\r\n}\r\n\r\nexport function trackAccessibilityFeatureEnabled(feature: string): void {\r\n  trackEvent('accessibility_feature_enabled', {\r\n    feature_name: feature,\r\n  });\r\n}\r\n\r\n// ============================================\r\n// SESSION & ENGAGEMENT TRACKING\r\n// ============================================\r\n\r\nexport function trackSessionStart(): void {\r\n  trackEvent('session_start', {\r\n    platform: getPlatform(),\r\n    is_pwa: isPWA(),\r\n  });\r\n}\r\n\r\nexport function trackSessionEngagement(durationSeconds: number, actionsCount: number): void {\r\n  trackEvent('session_engagement', {\r\n    duration_bucket: getSessionDurationBucket(durationSeconds),\r\n    actions_bucket: getActionsBucket(actionsCount),\r\n  });\r\n}\r\n\r\nfunction getPlatform(): string {\r\n  if (typeof navigator === 'undefined') return 'unknown';\r\n  const ua = navigator.userAgent.toLowerCase();\r\n  if (/iphone|ipad|ipod/.test(ua)) return 'ios';\r\n  if (/android/.test(ua)) return 'android';\r\n  if (/windows/.test(ua)) return 'windows';\r\n  if (/mac/.test(ua)) return 'mac';\r\n  return 'other';\r\n}\r\n\r\nfunction isPWA(): boolean {\r\n  if (typeof window === 'undefined') return false;\r\n\r\n  const nav = window.navigator as unknown;\r\n  const standalone =\r\n    typeof nav === 'object' &&\r\n    nav !== null &&\r\n    'standalone' in (nav as Record<string, unknown>)\r\n      ? (nav as { standalone?: unknown }).standalone\r\n      : undefined;\r\n\r\n  return window.matchMedia('(display-mode: standalone)').matches || standalone === true;\r\n}\r\n\r\nfunction getSessionDurationBucket(seconds: number): string {\r\n  if (seconds < 60) return 'brief';\r\n  if (seconds < 300) return 'short';\r\n  if (seconds < 900) return 'medium';\r\n  return 'extended';\r\n}\r\n\r\nfunction getActionsBucket(count: number): string {\r\n  if (count <= 3) return 'minimal';\r\n  if (count <= 10) return 'moderate';\r\n  if (count <= 25) return 'active';\r\n  return 'very_active';\r\n}\r\n\r\n// ============================================\r\n// EXPORT DEFAULT SERVICE OBJECT\r\n// ============================================\r\n\r\nexport const AnalyticsTrackingService = {\r\n  trackPainEntry,\r\n  trackWeatherCorrelation,\r\n  trackMoodEntry,\r\n  trackActivityLog,\r\n  trackMedicationLog,\r\n  trackTriggerIdentified,\r\n  trackPatternDetected,\r\n  trackFeatureUsed,\r\n  trackExportGenerated,\r\n  trackCrisisDetected,\r\n  trackCrisisEvent,\r\n  trackAccessibilityFeatureEnabled,\r\n  trackSessionStart,\r\n  trackSessionEngagement,\r\n  isAnalyticsEnabled,\r\n};\r\n\r\nexport default AnalyticsTrackingService;\r\n"],"names":["trackEvent","eventName","params","window","gtag","cleanParams","Object","fromEntries","entries","filter","v","e","trackCrisisDetected","severity","severity_level","trackCrisisEvent","data","trigger_count","triggerTypes","length","trigger_types","join","auto_emergency_mode","autoActivatedEmergencyMode","duration_bucket","durationSeconds","getCrisisDurationBucket","resolution_method","resolutionMethod","seconds","trackSessionStart","platform","getPlatform","is_pwa","isPWA","navigator","ua","userAgent","toLowerCase","test","nav","standalone","matchMedia","matches"],"mappings":"AAwBA,SAASA,EACPC,EACAC,GAEA,GARyB,oBAAXC,QAAiD,mBAAhBA,OAAOC,KAUtD,IAEE,MAAMC,EAAcC,OAAOC,YACzBD,OAAOE,QAAQN,GAAQO,OAAO,GAAIC,UAAa,IAANA,IAG3CP,OAAOC,OAAO,QAASH,EAAWI,EACpC,OAASM,GAET,CACF,CA0TO,SAASC,EAAoBC,GAClCb,EAAW,kBAAmB,CAC5Bc,eAAgBD,GAEpB,CAEO,SAASE,EAAiBC,GAC/BhB,EAAW,eAAgB,CACzBa,SAAUG,EAAKH,SACfI,cAAeD,EAAKE,aAAaC,OACjCC,cAAeJ,EAAKE,aAAaG,KAAK,KACtCC,oBAAqBN,EAAKO,2BAC1BC,qBAA0C,IAAzBR,EAAKS,gBAClBC,EAAwBV,EAAKS,sBAC7B,EACJE,kBAAmBX,EAAKY,kBAE5B,CAEA,SAASF,EAAwBG,GAC/B,OAAIA,EAAU,GAAW,QACrBA,EAAU,IAAY,QACtBA,EAAU,IAAY,WACnB,UACT,CAYO,SAASC,IACd9B,EAAW,gBAAiB,CAC1B+B,SAAUC,IACVC,OAAQC,KAEZ,CASA,SAASF,IACP,GAAyB,oBAAdG,UAA2B,MAAO,UAC7C,MAAMC,EAAKD,UAAUE,UAAUC,cAC/B,MAAI,mBAAmBC,KAAKH,GAAY,MACpC,UAAUG,KAAKH,GAAY,UAC3B,UAAUG,KAAKH,GAAY,UAC3B,MAAMG,KAAKH,GAAY,MACpB,OACT,CAEA,SAASF,IACP,GAAsB,oBAAX/B,OAAwB,OAAO,EAE1C,MAAMqC,EAAMrC,OAAOgC,UACbM,EACW,iBAARD,GACC,OAARA,GACA,eAAiBA,EACZA,EAAiCC,gBAClC,EAEN,OAAOtC,OAAOuC,WAAW,8BAA8BC,UAA0B,IAAfF,CACpE"}