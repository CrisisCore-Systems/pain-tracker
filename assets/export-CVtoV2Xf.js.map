{"version":3,"mappings":"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","names":["LOG_LEVEL_PRIORITY","debug","info","warn","error","DEFAULT_CONFIG","enabled","process","minLevel","maxBufferSize","includeCategories","excludeCategories","consoleOutput","debugLogger","config","buffer","listeners","constructor","this","configure","shouldLogCategory","category","includes","length","shouldLogLevel","level","log","message","metadata","entry","timestamp","Date","toISOString","push","shift","toUpperCase","forEach","listener","swallowed","operation","errorObj","Error","String","subscribe","filter","l","getBuffer","getByCategory","getByLevel","clearBuffer","exportBuffer","JSON","stringify","analyticsLogger","msg","meta","err","exportToCSV","entries","privacyAnalytics","trackDataExport","catch","context","exportType","trackDataExported","trackExport","join","map","isoDate","isoTimeWithZone","split","slice","baselineData","pain","locations","symptoms","functionalImpact","limitedActivities","qualityOfLife","sleepQuality","moodImpact","workImpact","missedWork","notes","replace","exportToJSON","downloadData","data","filename","mimeType","window","blob","startsWith","mime","base64Data","Blob","atob","type","url","URL","createObjectURL","link","document","createElement","href","download","body","appendChild","click","removeChild","revokeObjectURL","exportToPDF","async","default","jsPDF","__vitePreload","import","then","n","j","__VITE_PRELOAD__","doc","setFontSize","text","startDate","toLocaleDateString","endDate","avgPain","reduce","sum","formatNumber","mostCommonSymptoms","getMostCommonItems","flatMap","mostCommonLocations","yPosition","index","addPage","date","time","toLocaleTimeString","hour","minute","noteLines","splitTextToSize","pageCount","getNumberOfPages","i","setPage","output","items","count","item","Object","sort","a","b"],"ignoreList":[],"sources":["../../src/lib/debug-logger.ts","../../src/utils/pain-tracker/export.ts"],"sourcesContent":["/**\r\n * Debug Logging Utility\r\n *\r\n * Provides tiered logging for analytics and other operations that typically\r\n * swallow errors silently. This helps with debugging while not affecting\r\n * production user experience.\r\n *\r\n * @module lib/debug-logger\r\n */\r\n\r\nexport type LogLevel = 'debug' | 'info' | 'warn' | 'error';\r\n\r\nexport interface DebugLogEntry {\r\n  timestamp: string;\r\n  level: LogLevel;\r\n  category: string;\r\n  message: string;\r\n  metadata?: Record<string, unknown>;\r\n  error?: Error;\r\n}\r\n\r\nexport interface DebugLoggerConfig {\r\n  /** Enable debug logging (default: development mode only) */\r\n  enabled: boolean;\r\n  /** Minimum log level to output */\r\n  minLevel: LogLevel;\r\n  /** Maximum entries to keep in memory buffer */\r\n  maxBufferSize: number;\r\n  /** Categories to include (empty = all) */\r\n  includeCategories: string[];\r\n  /** Categories to exclude */\r\n  excludeCategories: string[];\r\n  /** Output to console */\r\n  consoleOutput: boolean;\r\n}\r\n\r\nconst LOG_LEVEL_PRIORITY: Record<LogLevel, number> = {\r\n  debug: 0,\r\n  info: 1,\r\n  warn: 2,\r\n  error: 3,\r\n};\r\n\r\nconst DEFAULT_CONFIG: DebugLoggerConfig = {\r\n  enabled: typeof process !== 'undefined' && process.env?.NODE_ENV !== 'production',\r\n  minLevel: 'debug',\r\n  maxBufferSize: 500,\r\n  includeCategories: [],\r\n  excludeCategories: [],\r\n  consoleOutput: true,\r\n};\r\n\r\n/**\r\n * Debug Logger for capturing silently-swallowed errors and analytics issues\r\n */\r\nclass DebugLogger {\r\n  private config: DebugLoggerConfig;\r\n  private buffer: DebugLogEntry[] = [];\r\n  private listeners: ((entry: DebugLogEntry) => void)[] = [];\r\n\r\n  constructor(config: Partial<DebugLoggerConfig> = {}) {\r\n    this.config = { ...DEFAULT_CONFIG, ...config };\r\n  }\r\n\r\n  /**\r\n   * Update logger configuration\r\n   */\r\n  configure(config: Partial<DebugLoggerConfig>): void {\r\n    this.config = { ...this.config, ...config };\r\n  }\r\n\r\n  /**\r\n   * Check if a category should be logged\r\n   */\r\n  private shouldLogCategory(category: string): boolean {\r\n    if (this.config.excludeCategories.includes(category)) return false;\r\n    if (this.config.includeCategories.length === 0) return true;\r\n    return this.config.includeCategories.includes(category);\r\n  }\r\n\r\n  /**\r\n   * Check if a level should be logged\r\n   */\r\n  private shouldLogLevel(level: LogLevel): boolean {\r\n    return LOG_LEVEL_PRIORITY[level] >= LOG_LEVEL_PRIORITY[this.config.minLevel];\r\n  }\r\n\r\n  /**\r\n   * Core logging method\r\n   */\r\n  private log(\r\n    level: LogLevel,\r\n    category: string,\r\n    message: string,\r\n    metadata?: Record<string, unknown>,\r\n    error?: Error\r\n  ): void {\r\n    if (!this.config.enabled) return;\r\n    if (!this.shouldLogLevel(level)) return;\r\n    if (!this.shouldLogCategory(category)) return;\r\n\r\n    const entry: DebugLogEntry = {\r\n      timestamp: new Date().toISOString(),\r\n      level,\r\n      category,\r\n      message,\r\n      metadata,\r\n      error,\r\n    };\r\n\r\n    // Add to buffer with size limit\r\n    this.buffer.push(entry);\r\n    if (this.buffer.length > this.config.maxBufferSize) {\r\n      this.buffer.shift();\r\n    }\r\n\r\n    // Console output\r\n    if (this.config.consoleOutput) {\r\n      const prefix = `[${level.toUpperCase()}][${category}]`;\r\n      const consoleMethod = level === 'error' ? 'error' : level === 'warn' ? 'warn' : 'debug';\r\n\r\n      if (error) {\r\n        console[consoleMethod](prefix, message, metadata ?? '', error);\r\n      } else if (metadata) {\r\n        console[consoleMethod](prefix, message, metadata);\r\n      } else {\r\n        console[consoleMethod](prefix, message);\r\n      }\r\n    }\r\n\r\n    // Notify listeners\r\n    this.listeners.forEach((listener) => listener(entry));\r\n  }\r\n\r\n  /**\r\n   * Log debug message\r\n   */\r\n  debug(category: string, message: string, metadata?: Record<string, unknown>): void {\r\n    this.log('debug', category, message, metadata);\r\n  }\r\n\r\n  /**\r\n   * Log info message\r\n   */\r\n  info(category: string, message: string, metadata?: Record<string, unknown>): void {\r\n    this.log('info', category, message, metadata);\r\n  }\r\n\r\n  /**\r\n   * Log warning message\r\n   */\r\n  warn(category: string, message: string, metadata?: Record<string, unknown>): void {\r\n    this.log('warn', category, message, metadata);\r\n  }\r\n\r\n  /**\r\n   * Log error message\r\n   */\r\n  error(category: string, message: string, error?: Error, metadata?: Record<string, unknown>): void {\r\n    this.log('error', category, message, metadata, error);\r\n  }\r\n\r\n  /**\r\n   * Log a swallowed error (from analytics, background operations, etc.)\r\n   */\r\n  swallowed(\r\n    category: string,\r\n    operation: string,\r\n    error: unknown,\r\n    metadata?: Record<string, unknown>\r\n  ): void {\r\n    const errorObj = error instanceof Error ? error : new Error(String(error));\r\n    this.log(\r\n      'warn',\r\n      category,\r\n      `Swallowed error in ${operation}`,\r\n      { ...metadata, operation },\r\n      errorObj\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Subscribe to log entries\r\n   */\r\n  subscribe(listener: (entry: DebugLogEntry) => void): () => void {\r\n    this.listeners.push(listener);\r\n    return () => {\r\n      this.listeners = this.listeners.filter((l) => l !== listener);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Get buffered log entries\r\n   */\r\n  getBuffer(): DebugLogEntry[] {\r\n    return [...this.buffer];\r\n  }\r\n\r\n  /**\r\n   * Get entries by category\r\n   */\r\n  getByCategory(category: string): DebugLogEntry[] {\r\n    return this.buffer.filter((entry) => entry.category === category);\r\n  }\r\n\r\n  /**\r\n   * Get entries by level\r\n   */\r\n  getByLevel(level: LogLevel): DebugLogEntry[] {\r\n    return this.buffer.filter((entry) => entry.level === level);\r\n  }\r\n\r\n  /**\r\n   * Clear the buffer\r\n   */\r\n  clearBuffer(): void {\r\n    this.buffer = [];\r\n  }\r\n\r\n  /**\r\n   * Export buffer as JSON string\r\n   */\r\n  exportBuffer(): string {\r\n    return JSON.stringify(this.buffer, null, 2);\r\n  }\r\n}\r\n\r\n// Singleton instance\r\nexport const debugLogger = new DebugLogger();\r\n\r\n// Pre-defined category loggers for convenience\r\nexport const analyticsLogger = {\r\n  debug: (msg: string, meta?: Record<string, unknown>) => debugLogger.debug('analytics', msg, meta),\r\n  info: (msg: string, meta?: Record<string, unknown>) => debugLogger.info('analytics', msg, meta),\r\n  warn: (msg: string, meta?: Record<string, unknown>) => debugLogger.warn('analytics', msg, meta),\r\n  error: (msg: string, err?: Error, meta?: Record<string, unknown>) =>\r\n    debugLogger.error('analytics', msg, err, meta),\r\n  swallowed: (operation: string, error: unknown, meta?: Record<string, unknown>) =>\r\n    debugLogger.swallowed('analytics', operation, error, meta),\r\n};\r\n\r\nexport const securityLogger = {\r\n  debug: (msg: string, meta?: Record<string, unknown>) => debugLogger.debug('security', msg, meta),\r\n  info: (msg: string, meta?: Record<string, unknown>) => debugLogger.info('security', msg, meta),\r\n  warn: (msg: string, meta?: Record<string, unknown>) => debugLogger.warn('security', msg, meta),\r\n  error: (msg: string, err?: Error, meta?: Record<string, unknown>) =>\r\n    debugLogger.error('security', msg, err, meta),\r\n  swallowed: (operation: string, error: unknown, meta?: Record<string, unknown>) =>\r\n    debugLogger.swallowed('security', operation, error, meta),\r\n};\r\n\r\nexport const storageLogger = {\r\n  debug: (msg: string, meta?: Record<string, unknown>) => debugLogger.debug('storage', msg, meta),\r\n  info: (msg: string, meta?: Record<string, unknown>) => debugLogger.info('storage', msg, meta),\r\n  warn: (msg: string, meta?: Record<string, unknown>) => debugLogger.warn('storage', msg, meta),\r\n  error: (msg: string, err?: Error, meta?: Record<string, unknown>) =>\r\n    debugLogger.error('storage', msg, err, meta),\r\n  swallowed: (operation: string, error: unknown, meta?: Record<string, unknown>) =>\r\n    debugLogger.swallowed('storage', operation, error, meta),\r\n};\r\n\r\nexport default debugLogger;\r\n","import type { PainEntry } from '../../types';\r\n// import jsPDF from 'jspdf'; // Moved to dynamic import\r\nimport { formatNumber } from '../formatting';\r\nimport { privacyAnalytics } from '../../services/PrivacyAnalyticsService';\r\nimport { trackDataExported } from '../../analytics/ga4-events';\r\nimport { trackExport } from '../usage-tracking';\r\nimport { analyticsLogger } from '../../lib/debug-logger';\r\n\r\nexport const exportToCSV = (entries: PainEntry[]): string => {\r\n  // Track export analytics\r\n  privacyAnalytics.trackDataExport('csv').catch((error) => {\r\n    analyticsLogger.swallowed(error, { context: 'exportToCSV', exportType: 'csv' });\r\n  });\r\n\r\n  // Track GA4 custom event\r\n  trackDataExported('csv', entries.length);\r\n  \r\n  // Track local usage\r\n  trackExport('csv', entries.length);\r\n\r\n  const headers = [\r\n    'Date',\r\n    'Time',\r\n    'Pain Level',\r\n    'Locations',\r\n    'Symptoms',\r\n    'Limited Activities',\r\n    'Sleep Quality',\r\n    'Mood Impact',\r\n    'Missed Work Days',\r\n    'Notes',\r\n  ].join(',');\r\n\r\n  const rows = entries.map(entry => {\r\n    // Use the original ISO timestamp to avoid timezone differences\r\n    const [isoDate, isoTimeWithZone] = entry.timestamp.split('T');\r\n    const time = (isoTimeWithZone || '').slice(0, 5); // HH:mm from HH:mm:ssZ\r\n    return [\r\n      isoDate,\r\n      time,\r\n      entry.baselineData.pain,\r\n      `\"${entry.baselineData.locations?.join('; ') || ''}\"`,\r\n      `\"${entry.baselineData.symptoms?.join('; ') || ''}\"`,\r\n      `\"${entry.functionalImpact?.limitedActivities?.join('; ') || ''}\"`,\r\n      entry.qualityOfLife?.sleepQuality || '',\r\n      entry.qualityOfLife?.moodImpact || '',\r\n      entry.workImpact?.missedWork || '',\r\n      `\"${entry.notes?.replace(/\"/g, '\"\"') || ''}\"`,\r\n    ].join(',');\r\n  });\r\n\r\n  return [headers, ...rows].join('\\\\n');\r\n};\r\n\r\nexport const exportToJSON = (entries: PainEntry[]): string => {\r\n  // Track export analytics\r\n  privacyAnalytics.trackDataExport('json').catch((error) => {\r\n    analyticsLogger.swallowed(error, { context: 'exportToJSON', exportType: 'json' });\r\n  });\r\n\r\n  // Track GA4 custom event\r\n  trackDataExported('json', entries.length);\r\n  \r\n  // Track local usage\r\n  trackExport('json', entries.length);\r\n\r\n  return JSON.stringify(entries, null, 2);\r\n};\r\n\r\nexport const downloadData = (\r\n  data: string,\r\n  filename: string,\r\n  mimeType: string = 'text/plain;charset=utf-8'\r\n): void => {\r\n  if (typeof window === 'undefined') return;\r\n\r\n  let blob: Blob;\r\n  if (data.startsWith('data:')) {\r\n    // Handle data URIs (like PDFs from jsPDF)\r\n    const [mime, base64Data] = data.split(',');\r\n    blob = new Blob([atob(base64Data)], { type: mime.split(':')[1].split(';')[0] });\r\n  } else {\r\n    blob = new Blob([data], { type: mimeType });\r\n  }\r\n\r\n  const url = window.URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.href = url;\r\n  link.download = filename;\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  window.URL.revokeObjectURL(url);\r\n};\r\n\r\nexport const exportToPDF = async (entries: PainEntry[]): Promise<string> => {\r\n  // Track export analytics\r\n  privacyAnalytics.trackDataExport('pdf').catch((error) => {\r\n    analyticsLogger.swallowed(error, { context: 'exportToPDF', exportType: 'pdf' });\r\n  });\r\n\r\n  // Track GA4 custom event\r\n  trackDataExported('pdf', entries.length);\r\n  \r\n  // Track local usage\r\n  trackExport('pdf', entries.length);\r\n\r\n  const { default: jsPDF } = await import('jspdf');\r\n  const doc = new jsPDF();\r\n\r\n  // Title\r\n  doc.setFontSize(20);\r\n  doc.text('Pain Tracking Report', 20, 30);\r\n\r\n  // Date range\r\n  doc.setFontSize(12);\r\n  const startDate =\r\n    entries.length > 0 ? new Date(entries[0].timestamp).toLocaleDateString() : 'N/A';\r\n  const endDate =\r\n    entries.length > 0\r\n      ? new Date(entries[entries.length - 1].timestamp).toLocaleDateString()\r\n      : 'N/A';\r\n  doc.text(`Report Period: ${startDate} to ${endDate}`, 20, 45);\r\n\r\n  // Summary statistics\r\n  doc.text(`Total Entries: ${entries.length}`, 20, 55);\r\n\r\n  if (entries.length > 0) {\r\n    const avgPain =\r\n      entries.reduce((sum, entry) => sum + entry.baselineData.pain, 0) / entries.length;\r\n    doc.text(`Average Pain Level: ${formatNumber(avgPain, 1)}/10`, 20, 65);\r\n\r\n    const mostCommonSymptoms = getMostCommonItems(\r\n      entries.flatMap(entry => entry.baselineData.symptoms || [])\r\n    );\r\n    const mostCommonLocations = getMostCommonItems(\r\n      entries.flatMap(entry => entry.baselineData.locations || [])\r\n    );\r\n\r\n    doc.text(`Most Common Symptoms: ${mostCommonSymptoms.slice(0, 3).join(', ')}`, 20, 75);\r\n    doc.text(`Most Common Locations: ${mostCommonLocations.slice(0, 3).join(', ')}`, 20, 85);\r\n  }\r\n\r\n  // Detailed entries\r\n  let yPosition = 105;\r\n  doc.setFontSize(14);\r\n  doc.text('Detailed Entries', 20, yPosition);\r\n  yPosition += 15;\r\n\r\n  doc.setFontSize(10);\r\n  entries.slice(0, 20).forEach((entry, index) => {\r\n    // Limit to first 20 entries for PDF\r\n    if (yPosition > 270) {\r\n      // Start new page if needed\r\n      doc.addPage();\r\n      yPosition = 30;\r\n    }\r\n\r\n    const date = new Date(entry.timestamp).toLocaleDateString();\r\n    const time = new Date(entry.timestamp).toLocaleTimeString([], {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n    });\r\n\r\n    doc.text(`${index + 1}. ${date} ${time} - Pain: ${entry.baselineData.pain}/10`, 20, yPosition);\r\n    yPosition += 8;\r\n\r\n    if (entry.baselineData.symptoms && entry.baselineData.symptoms.length > 0) {\r\n      doc.text(`   Symptoms: ${entry.baselineData.symptoms.join(', ')}`, 25, yPosition);\r\n      yPosition += 8;\r\n    }\r\n\r\n    if (entry.baselineData.locations && entry.baselineData.locations.length > 0) {\r\n      doc.text(`   Locations: ${entry.baselineData.locations.join(', ')}`, 25, yPosition);\r\n      yPosition += 8;\r\n    }\r\n\r\n    if (entry.notes) {\r\n      const noteLines = doc.splitTextToSize(`   Notes: ${entry.notes}`, 150);\r\n      doc.text(noteLines, 25, yPosition);\r\n      yPosition += noteLines.length * 5 + 5;\r\n    }\r\n\r\n    yPosition += 5; // Extra space between entries\r\n  });\r\n\r\n  if (entries.length > 20) {\r\n    doc.text(`... and ${entries.length - 20} more entries`, 20, yPosition);\r\n  }\r\n\r\n  // Footer\r\n  const pageCount = doc.getNumberOfPages();\r\n  for (let i = 1; i <= pageCount; i++) {\r\n    doc.setPage(i);\r\n    doc.setFontSize(8);\r\n    doc.text(\r\n      `Generated on ${new Date().toLocaleDateString()} - Page ${i} of ${pageCount}`,\r\n      20,\r\n      285\r\n    );\r\n  }\r\n\r\n  return doc.output('datauristring');\r\n};\r\n\r\nconst getMostCommonItems = (items: string[]): string[] => {\r\n  const count: Record<string, number> = {};\r\n  items.forEach(item => {\r\n    count[item] = (count[item] || 0) + 1;\r\n  });\r\n\r\n  return Object.entries(count)\r\n    .sort(([, a], [, b]) => b - a)\r\n    .map(([item]) => item);\r\n};\r\n"],"file":"export-CVtoV2Xf.js"}