{"version":3,"mappings":"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","names":["PatientClaimInfoModal","isOpen","onClose","onSubmit","initialData","formData","setFormData","useState","errors","setErrors","validateForm","newErrors","handleSubmit","e","handleChange","field","value","prev","jsxDEV","this","X","captureCanvasChart","canvasElement","error","captureSVGChart","svgElement","clonedSvg","styles","width","height","svgString","blob","convertSVGToPNG","resolve","reject","canvas","ctx","scale","img","svgBlob","url","dataUrl","captureChartById","elementId","type","element","captureMultipleCharts","charts","results","chart","waitForChartsToRender","timeout","ClinicalPDFExportButton","entries","moodEntries","className","variant","showModal","setShowModal","isExporting","setIsExporting","setError","logPdfAudit","useCallback","action","actionType","outcome","details","hipaaComplianceService","auditError","handleExportClick","handleSubmitPatientInfo","patientInfo","chartImages","ClinicalPDFExporter","__vitePreload","err","Fragment","FileText","Download"],"ignoreList":[],"sources":["../../src/components/export/PatientClaimInfoModal.tsx","../../src/utils/chartCapture.ts","../../src/components/export/ClinicalPDFExportButton.tsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport { X } from 'lucide-react';\r\n\r\nexport interface PatientClaimInfo {\r\n  patientName: string;\r\n  patientDOB: string;\r\n  patientAddress: string;\r\n  patientPhone: string;\r\n  claimNumber: string;\r\n  injuryDate: string;\r\n  employerName: string;\r\n  physicianName: string;\r\n  physicianPhone: string;\r\n}\r\n\r\ninterface PatientClaimInfoModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onSubmit: (info: PatientClaimInfo) => void;\r\n  initialData?: Partial<PatientClaimInfo>;\r\n}\r\n\r\n/**\r\n * Patient and Claim Information Form\r\n * \r\n * Collects WorkSafe BC required information for clinical PDF export.\r\n * Trauma-informed design with gentle validation and clear labels.\r\n */\r\nexport const PatientClaimInfoModal: React.FC<PatientClaimInfoModalProps> = ({\r\n  isOpen,\r\n  onClose,\r\n  onSubmit,\r\n  initialData = {},\r\n}) => {\r\n  const [formData, setFormData] = useState<PatientClaimInfo>({\r\n    patientName: initialData.patientName || '',\r\n    patientDOB: initialData.patientDOB || '',\r\n    patientAddress: initialData.patientAddress || '',\r\n    patientPhone: initialData.patientPhone || '',\r\n    claimNumber: initialData.claimNumber || '',\r\n    injuryDate: initialData.injuryDate || '',\r\n    employerName: initialData.employerName || '',\r\n    physicianName: initialData.physicianName || '',\r\n    physicianPhone: initialData.physicianPhone || '',\r\n  });\r\n\r\n  const [errors, setErrors] = useState<Partial<Record<keyof PatientClaimInfo, string>>>({});\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const validateForm = (): boolean => {\r\n    const newErrors: Partial<Record<keyof PatientClaimInfo, string>> = {};\r\n\r\n    if (!formData.patientName.trim()) {\r\n      newErrors.patientName = 'Patient name is required';\r\n    }\r\n\r\n    if (!formData.claimNumber.trim()) {\r\n      newErrors.claimNumber = 'Claim number is required for WorkSafe BC';\r\n    }\r\n\r\n    if (!formData.injuryDate) {\r\n      newErrors.injuryDate = 'Injury date is required';\r\n    }\r\n\r\n    setErrors(newErrors);\r\n    return Object.keys(newErrors).length === 0;\r\n  };\r\n\r\n  const handleSubmit = (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n\r\n    if (validateForm()) {\r\n      onSubmit(formData);\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const handleChange = (field: keyof PatientClaimInfo, value: string) => {\r\n    setFormData((prev) => ({ ...prev, [field]: value }));\r\n    // Clear error when user starts typing\r\n    if (errors[field]) {\r\n      setErrors((prev) => ({ ...prev, [field]: undefined }));\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex items-center justify-center p-4\"\r\n      role=\"dialog\"\r\n      aria-labelledby=\"patient-info-title\"\r\n      aria-modal=\"true\"\r\n    >\r\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto\">\r\n        {/* Header */}\r\n        <div className=\"sticky top-0 bg-gradient-to-r from-blue-600 to-purple-600 text-white p-6 rounded-t-lg flex items-center justify-between\">\r\n          <div>\r\n            <h2 id=\"patient-info-title\" className=\"text-xl font-bold\">\r\n              Patient & Claim Information\r\n            </h2>\r\n            <p className=\"text-sm text-blue-100 mt-1\">\r\n              Required for WorkSafe BC clinical report\r\n            </p>\r\n          </div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"text-white hover:bg-white/20 rounded-full p-2 transition-colors\"\r\n            aria-label=\"Close dialog\"\r\n          >\r\n            <X size={24} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <form onSubmit={handleSubmit} className=\"p-6 space-y-6\">\r\n          {/* Patient Information Section */}\r\n          <fieldset>\r\n            <legend className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n              <span className=\"text-2xl\">ðŸ‘¤</span> Patient Information\r\n            </legend>\r\n\r\n            <div className=\"space-y-4\">\r\n              <div>\r\n                <label\r\n                  htmlFor=\"patientName\"\r\n                  className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                >\r\n                  Full Name <span className=\"text-red-500\">*</span>\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"patientName\"\r\n                  value={formData.patientName}\r\n                  onChange={(e) => handleChange('patientName', e.target.value)}\r\n                  className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${\r\n                    errors.patientName ? 'border-red-500' : 'border-gray-300'\r\n                  }`}\r\n                  placeholder=\"John Doe\"\r\n                  aria-invalid={!!errors.patientName}\r\n                  aria-describedby={errors.patientName ? 'patientName-error' : undefined}\r\n                />\r\n                {errors.patientName && (\r\n                  <p id=\"patientName-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                    {errors.patientName}\r\n                  </p>\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"patientDOB\"\r\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                  >\r\n                    Date of Birth\r\n                  </label>\r\n                  <input\r\n                    type=\"date\"\r\n                    id=\"patientDOB\"\r\n                    value={formData.patientDOB}\r\n                    onChange={(e) => handleChange('patientDOB', e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"patientPhone\"\r\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                  >\r\n                    Phone Number\r\n                  </label>\r\n                  <input\r\n                    type=\"tel\"\r\n                    id=\"patientPhone\"\r\n                    value={formData.patientPhone}\r\n                    onChange={(e) => handleChange('patientPhone', e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                    placeholder=\"(555) 123-4567\"\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label\r\n                  htmlFor=\"patientAddress\"\r\n                  className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                >\r\n                  Address\r\n                </label>\r\n                <textarea\r\n                  id=\"patientAddress\"\r\n                  value={formData.patientAddress}\r\n                  onChange={(e) => handleChange('patientAddress', e.target.value)}\r\n                  rows={2}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                  placeholder=\"123 Main St, City, Province, Postal Code\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </fieldset>\r\n\r\n          {/* WorkSafe BC Claim Information */}\r\n          <fieldset className=\"pt-6 border-t border-gray-200 dark:border-gray-700\">\r\n            <legend className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n              <span className=\"text-2xl\">ðŸ“‹</span> WorkSafe BC Claim\r\n            </legend>\r\n\r\n            <div className=\"space-y-4\">\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"claimNumber\"\r\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                  >\r\n                    Claim Number <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"claimNumber\"\r\n                    value={formData.claimNumber}\r\n                    onChange={(e) => handleChange('claimNumber', e.target.value)}\r\n                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${\r\n                      errors.claimNumber ? 'border-red-500' : 'border-gray-300'\r\n                    }`}\r\n                    placeholder=\"WCB-2025-12345\"\r\n                    aria-invalid={!!errors.claimNumber}\r\n                    aria-describedby={errors.claimNumber ? 'claimNumber-error' : undefined}\r\n                  />\r\n                  {errors.claimNumber && (\r\n                    <p id=\"claimNumber-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                      {errors.claimNumber}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"injuryDate\"\r\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                  >\r\n                    Date of Injury <span className=\"text-red-500\">*</span>\r\n                  </label>\r\n                  <input\r\n                    type=\"date\"\r\n                    id=\"injuryDate\"\r\n                    value={formData.injuryDate}\r\n                    onChange={(e) => handleChange('injuryDate', e.target.value)}\r\n                    className={`w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white ${\r\n                      errors.injuryDate ? 'border-red-500' : 'border-gray-300'\r\n                    }`}\r\n                    aria-invalid={!!errors.injuryDate}\r\n                    aria-describedby={errors.injuryDate ? 'injuryDate-error' : undefined}\r\n                  />\r\n                  {errors.injuryDate && (\r\n                    <p id=\"injuryDate-error\" className=\"mt-1 text-sm text-red-600 dark:text-red-400\">\r\n                      {errors.injuryDate}\r\n                    </p>\r\n                  )}\r\n                </div>\r\n              </div>\r\n\r\n              <div>\r\n                <label\r\n                  htmlFor=\"employerName\"\r\n                  className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                >\r\n                  Employer Name\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  id=\"employerName\"\r\n                  value={formData.employerName}\r\n                  onChange={(e) => handleChange('employerName', e.target.value)}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                  placeholder=\"Company Name\"\r\n                />\r\n              </div>\r\n            </div>\r\n          </fieldset>\r\n\r\n          {/* Healthcare Provider Information */}\r\n          <fieldset className=\"pt-6 border-t border-gray-200 dark:border-gray-700\">\r\n            <legend className=\"text-lg font-semibold text-gray-900 dark:text-white mb-4 flex items-center gap-2\">\r\n              <span className=\"text-2xl\">ðŸ©º</span> Healthcare Provider\r\n            </legend>\r\n\r\n            <div className=\"space-y-4\">\r\n              <div className=\"grid md:grid-cols-2 gap-4\">\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"physicianName\"\r\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                  >\r\n                    Physician Name\r\n                  </label>\r\n                  <input\r\n                    type=\"text\"\r\n                    id=\"physicianName\"\r\n                    value={formData.physicianName}\r\n                    onChange={(e) => handleChange('physicianName', e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                    placeholder=\"Dr. Jane Smith\"\r\n                  />\r\n                </div>\r\n\r\n                <div>\r\n                  <label\r\n                    htmlFor=\"physicianPhone\"\r\n                    className=\"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1\"\r\n                  >\r\n                    Physician Phone\r\n                  </label>\r\n                  <input\r\n                    type=\"tel\"\r\n                    id=\"physicianPhone\"\r\n                    value={formData.physicianPhone}\r\n                    onChange={(e) => handleChange('physicianPhone', e.target.value)}\r\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white\"\r\n                    placeholder=\"(555) 987-6543\"\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </fieldset>\r\n\r\n          {/* Help Text */}\r\n          <div className=\"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4\">\r\n            <p className=\"text-sm text-blue-800 dark:text-blue-300 flex items-start gap-2\">\r\n              <span className=\"text-lg\">ðŸ’¡</span>\r\n              <span>\r\n                <strong>Privacy Notice:</strong> This information is used only to generate your\r\n                clinical report. All data remains on your device and is encrypted. Fields marked\r\n                with * are required for WorkSafe BC compliance.\r\n              </span>\r\n            </p>\r\n          </div>\r\n\r\n          {/* Form Actions */}\r\n          <div className=\"flex gap-3 pt-4\">\r\n            <button\r\n              type=\"button\"\r\n              onClick={onClose}\r\n              className=\"flex-1 px-6 py-3 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors font-medium\"\r\n            >\r\n              Cancel\r\n            </button>\r\n            <button\r\n              type=\"submit\"\r\n              className=\"flex-1 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium shadow-lg\"\r\n            >\r\n              Generate Report\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","/**\r\n * Chart Capture Utilities\r\n * \r\n * Provides functions to capture chart elements as data URLs for PDF embedding.\r\n * Supports both canvas-based and SVG-based charts.\r\n */\r\n\r\n/**\r\n * Capture a canvas element as a data URL\r\n */\r\nexport const captureCanvasChart = (canvasElement: HTMLCanvasElement): string => {\r\n  try {\r\n    return canvasElement.toDataURL('image/png', 1.0);\r\n  } catch (error) {\r\n    console.error('Failed to capture canvas chart:', error);\r\n    return '';\r\n  }\r\n};\r\n\r\n/**\r\n * Capture an SVG element as a data URL\r\n */\r\nexport const captureSVGChart = async (svgElement: SVGElement): Promise<string> => {\r\n  try {\r\n    // Clone the SVG to avoid modifying the original\r\n    const clonedSvg = svgElement.cloneNode(true) as SVGElement;\r\n    \r\n    // Get computed styles\r\n    const styles = window.getComputedStyle(svgElement);\r\n    const width = parseInt(styles.width);\r\n    const height = parseInt(styles.height);\r\n    \r\n    // Set explicit dimensions\r\n    clonedSvg.setAttribute('width', width.toString());\r\n    clonedSvg.setAttribute('height', height.toString());\r\n    \r\n    // Serialize SVG to string\r\n    const serializer = new XMLSerializer();\r\n    const svgString = serializer.serializeToString(clonedSvg);\r\n    \r\n    // Create a blob and convert to data URL\r\n    const blob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\r\n    \r\n    // Convert to PNG via canvas for better PDF compatibility\r\n    return await convertSVGToPNG(svgString, width, height);\r\n  } catch (error) {\r\n    console.error('Failed to capture SVG chart:', error);\r\n    return '';\r\n  }\r\n};\r\n\r\n/**\r\n * Convert SVG string to PNG data URL\r\n */\r\nconst convertSVGToPNG = (svgString: string, width: number, height: number): Promise<string> => {\r\n  return new Promise((resolve, reject) => {\r\n    const canvas = document.createElement('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n    \r\n    if (!ctx) {\r\n      reject(new Error('Failed to get canvas context'));\r\n      return;\r\n    }\r\n    \r\n    // Set canvas dimensions with scale factor for better quality\r\n    const scale = 2;\r\n    canvas.width = width * scale;\r\n    canvas.height = height * scale;\r\n    ctx.scale(scale, scale);\r\n    \r\n    // Create image from SVG\r\n    const img = new Image();\r\n    const svgBlob = new Blob([svgString], { type: 'image/svg+xml;charset=utf-8' });\r\n    const url = URL.createObjectURL(svgBlob);\r\n    \r\n    img.onload = () => {\r\n      ctx.drawImage(img, 0, 0);\r\n      URL.revokeObjectURL(url);\r\n      \r\n      try {\r\n        const dataUrl = canvas.toDataURL('image/png', 1.0);\r\n        resolve(dataUrl);\r\n      } catch (error) {\r\n        reject(error);\r\n      }\r\n    };\r\n    \r\n    img.onerror = () => {\r\n      URL.revokeObjectURL(url);\r\n      reject(new Error('Failed to load SVG image'));\r\n    };\r\n    \r\n    img.src = url;\r\n  });\r\n};\r\n\r\n/**\r\n * Capture a chart by ID or selector\r\n */\r\nexport const captureChartById = async (\r\n  elementId: string,\r\n  type: 'canvas' | 'svg' = 'canvas'\r\n): Promise<string> => {\r\n  const element = document.getElementById(elementId) || document.querySelector(elementId);\r\n  \r\n  if (!element) {\r\n    console.warn(`Chart element not found: ${elementId}`);\r\n    return '';\r\n  }\r\n  \r\n  if (type === 'canvas' && element instanceof HTMLCanvasElement) {\r\n    return captureCanvasChart(element);\r\n  } else if (type === 'svg' && element instanceof SVGElement) {\r\n    return await captureSVGChart(element);\r\n  } else {\r\n    console.warn(`Element ${elementId} is not a ${type} element`);\r\n    return '';\r\n  }\r\n};\r\n\r\n/**\r\n * Capture multiple charts at once\r\n */\r\nexport const captureMultipleCharts = async (\r\n  charts: Array<{ id: string; type: 'canvas' | 'svg' }>\r\n): Promise<Record<string, string>> => {\r\n  const results: Record<string, string> = {};\r\n  \r\n  for (const chart of charts) {\r\n    results[chart.id] = await captureChartById(chart.id, chart.type);\r\n  }\r\n  \r\n  return results;\r\n};\r\n\r\n/**\r\n * Wait for charts to render before capturing\r\n */\r\nexport const waitForChartsToRender = (timeout = 2000): Promise<void> => {\r\n  return new Promise((resolve) => {\r\n    // Use requestAnimationFrame to wait for rendering\r\n    requestAnimationFrame(() => {\r\n      setTimeout(resolve, timeout);\r\n    });\r\n  });\r\n};\r\n\r\n/**\r\n * Create a placeholder chart image for when actual chart is unavailable\r\n */\r\nexport const createPlaceholderChart = (width = 600, height = 400, text = 'Chart Not Available'): string => {\r\n  const canvas = document.createElement('canvas');\r\n  canvas.width = width;\r\n  canvas.height = height;\r\n  \r\n  const ctx = canvas.getContext('2d');\r\n  if (!ctx) return '';\r\n  \r\n  // Background\r\n  ctx.fillStyle = '#f3f4f6';\r\n  ctx.fillRect(0, 0, width, height);\r\n  \r\n  // Border\r\n  ctx.strokeStyle = '#d1d5db';\r\n  ctx.lineWidth = 2;\r\n  ctx.strokeRect(0, 0, width, height);\r\n  \r\n  // Text\r\n  ctx.fillStyle = '#6b7280';\r\n  ctx.font = '16px sans-serif';\r\n  ctx.textAlign = 'center';\r\n  ctx.textBaseline = 'middle';\r\n  ctx.fillText(text, width / 2, height / 2);\r\n  \r\n  return canvas.toDataURL('image/png');\r\n};\r\n","import React, { useState, useCallback } from 'react';\r\nimport { FileText, Download } from 'lucide-react';\r\nimport { PatientClaimInfoModal, type PatientClaimInfo } from './PatientClaimInfoModal';\r\nimport { captureMultipleCharts, waitForChartsToRender } from '../../utils/chartCapture';\r\nimport type { PainEntry } from '../../types';\r\nimport type { MoodEntry } from '../../types/quantified-empathy';\r\nimport { hipaaComplianceService } from '../../services/HIPAACompliance';\r\nimport type { AuditTrail } from '../../services/HIPAACompliance';\r\n\r\ntype AuditActionType = AuditTrail['actionType'];\r\ntype AuditOutcome = AuditTrail['outcome'];\r\n\r\ninterface ClinicalPDFExportButtonProps {\r\n  entries: PainEntry[];\r\n  moodEntries?: MoodEntry[];\r\n  className?: string;\r\n  variant?: 'button' | 'compact';\r\n}\r\n\r\n/**\r\n * Clinical PDF Export Button with Patient Info Collection\r\n * \r\n * Integrates patient info modal, chart capture, and PDF generation.\r\n * Provides user feedback during export process.\r\n */\r\nexport const ClinicalPDFExportButton: React.FC<ClinicalPDFExportButtonProps> = ({\r\n  entries,\r\n  moodEntries = [],\r\n  className = '',\r\n  variant = 'button',\r\n}) => {\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [isExporting, setIsExporting] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n\r\n  const logPdfAudit = useCallback(\r\n    async ({\r\n      action,\r\n      actionType = 'export',\r\n      outcome = 'success',\r\n      details = {}\r\n    }: {\r\n      action: string;\r\n      actionType?: AuditActionType;\r\n      outcome?: AuditOutcome;\r\n      details?: Record<string, unknown>;\r\n    }) => {\r\n      try {\r\n        await hipaaComplianceService.logAuditEvent({\r\n          actionType,\r\n          userId: 'local-user',\r\n          userRole: 'patient',\r\n          resourceType: 'ClinicalPDFExport',\r\n          outcome,\r\n          details: {\r\n            action,\r\n            entryCount: entries.length,\r\n            moodEntryCount: moodEntries.length,\r\n            ...details\r\n          }\r\n        });\r\n      } catch (auditError) {\r\n        console.error('HIPAA audit logging failed', auditError);\r\n      }\r\n    },\r\n    [entries.length, moodEntries.length]\r\n  );\r\n\r\n  const handleExportClick = () => {\r\n    if (entries.length === 0) {\r\n      setError('No pain entries to export');\r\n      void logPdfAudit({\r\n        action: 'clinical-pdf-export',\r\n        outcome: 'failure',\r\n        details: { reason: 'no-entries' }\r\n      });\r\n      return;\r\n    }\r\n    setError(null);\r\n    setShowModal(true);\r\n    void logPdfAudit({\r\n      action: 'clinical-pdf-export',\r\n      actionType: 'access',\r\n      details: { step: 'patient-info-modal' }\r\n    });\r\n  };\r\n\r\n  const handleSubmitPatientInfo = async (patientInfo: PatientClaimInfo) => {\r\n    setIsExporting(true);\r\n    setError(null);\r\n    void logPdfAudit({\r\n      action: 'clinical-pdf-export',\r\n      details: {\r\n        stage: 'generation-start',\r\n        hasPatientInfo: Boolean(patientInfo)\r\n      }\r\n    });\r\n\r\n    try {\r\n      // Wait for charts to render\r\n      await waitForChartsToRender(1000);\r\n\r\n      // Capture chart images\r\n      const chartImages = await captureMultipleCharts([\r\n        { id: 'pain-trend-chart', type: 'canvas' },\r\n        { id: 'pain-distribution-chart', type: 'canvas' },\r\n      ]);\r\n\r\n      // Lazy load PDF exporter to defer jsPDF bundle loading (Phase 3 optimization)\r\n      const { ClinicalPDFExporter } = await import('../../services/ClinicalPDFExporter');\r\n      const exporter = new ClinicalPDFExporter();\r\n      await exporter.generateReport({\r\n        entries,\r\n        patientInfo,\r\n        moodEntries,\r\n        charts: {\r\n          painTrend: chartImages['pain-trend-chart'],\r\n          painDistribution: chartImages['pain-distribution-chart'],\r\n        },\r\n        includeNarrative: true,\r\n      });\r\n\r\n      // Success feedback\r\n      if ('vibrate' in navigator) {\r\n        navigator.vibrate([100, 50, 100]);\r\n      }\r\n      await logPdfAudit({\r\n        action: 'clinical-pdf-export',\r\n        details: {\r\n          stage: 'generation-complete',\r\n          chartsCaptured: Object.keys(chartImages).length\r\n        }\r\n      });\r\n    } catch (err) {\r\n      console.error('PDF export failed:', err);\r\n      setError('Failed to generate PDF. Please try again.');\r\n      await logPdfAudit({\r\n        action: 'clinical-pdf-export',\r\n        outcome: 'failure',\r\n        details: {\r\n          stage: 'generation-error',\r\n          error: err instanceof Error ? err.message : 'unknown-error'\r\n        }\r\n      });\r\n    } finally {\r\n      setIsExporting(false);\r\n    }\r\n  };\r\n\r\n  if (variant === 'compact') {\r\n    return (\r\n      <>\r\n        <button\r\n          onClick={handleExportClick}\r\n          disabled={isExporting || entries.length === 0}\r\n          className={`inline-flex items-center gap-2 px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-sm font-medium ${className}`}\r\n          aria-label=\"Export clinical PDF report\"\r\n        >\r\n          {isExporting ? (\r\n            <>\r\n              <div className=\"animate-spin rounded-full h-4 w-4 border-b-2 border-white\" />\r\n              Exporting...\r\n            </>\r\n          ) : (\r\n            <>\r\n              <FileText size={16} />\r\n              Export PDF\r\n            </>\r\n          )}\r\n        </button>\r\n\r\n        {error && (\r\n          <p className=\"text-sm text-red-600 dark:text-red-400 mt-2\" role=\"alert\">\r\n            {error}\r\n          </p>\r\n        )}\r\n\r\n        <PatientClaimInfoModal\r\n          isOpen={showModal}\r\n          onClose={() => setShowModal(false)}\r\n          onSubmit={handleSubmitPatientInfo}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className={className}>\r\n      <button\r\n        onClick={handleExportClick}\r\n        disabled={isExporting || entries.length === 0}\r\n        className=\"w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl font-medium text-lg\"\r\n        aria-label=\"Export clinical PDF report\"\r\n      >\r\n        {isExporting ? (\r\n          <>\r\n            <div className=\"animate-spin rounded-full h-6 w-6 border-b-2 border-white\" />\r\n            <span>Generating PDF Report...</span>\r\n          </>\r\n        ) : (\r\n          <>\r\n            <Download size={24} />\r\n            <span>Export Clinical PDF Report</span>\r\n          </>\r\n        )}\r\n      </button>\r\n\r\n      {error && (\r\n        <div\r\n          className=\"mt-4 p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg\"\r\n          role=\"alert\"\r\n        >\r\n          <p className=\"text-sm text-red-800 dark:text-red-300\">{error}</p>\r\n        </div>\r\n      )}\r\n\r\n      {entries.length === 0 && (\r\n        <p className=\"mt-4 text-sm text-gray-600 dark:text-gray-400 text-center\">\r\n          Start tracking your pain to generate clinical reports\r\n        </p>\r\n      )}\r\n\r\n      <PatientClaimInfoModal\r\n        isOpen={showModal}\r\n        onClose={() => setShowModal(false)}\r\n        onSubmit={handleSubmitPatientInfo}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n"],"file":"ClinicalPDFExportButton-XFmRkKvU.js"}