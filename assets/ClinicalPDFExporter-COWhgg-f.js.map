{"version":3,"mappings":"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","names":["getPainIntensity","entry","intensity","baselineData","pain","getPainLocation","location","locations","join","getPainQuality","quality","symptoms","ClinicalPDFExporter","doc","initializePDF","this","default","jsPDF","_","Promise","all","__vitePreload","import","__VITE_PRELOAD__","then","n","c","pageWidth","pageHeight","margin","currentY","lineHeight","primaryColor","secondaryColor","accentColor","constructor","generateReport","options","internal","pageSize","getWidth","getHeight","setupMetadata","addHeader","wcbCompliant","addPatientInformation","patientInfo","addExecutiveSummary","entries","moodEntries","charts","addCharts","addPainEntryTable","dateRange","includeNarrative","addNarrativeTimeline","clinicalNotes","addClinicalNotes","addWCBComplianceSections","addFooters","output","metadata","title","subject","start","toLocaleDateString","end","author","physicianName","keywords","creator","setProperties","setFontSize","setTextColor","setFont","text","Date","toLocaleString","align","setDrawColor","setLineWidth","line","info","checkPageBreak","name","dateOfBirth","patientId","claimNumber","injuryDate","physicianPhone","forEach","label","value","avgPain","reduce","sum","e","length","maxPain","Math","max","map","minPain","min","totalEntries","timestamp","setFillColor","rect","toFixed","getPainCategory","chartWidth","painTrend","addImage","chartHeight","error","painDistribution","filteredEntries","filter","entryDate","tableData","slice","month","day","hour","minute","toString","triggers","autoTable","startY","head","body","theme","headStyles","fillColor","textColor","fontSize","fontStyle","bodyStyles","alternateRowStyles","left","right","didDrawPage","data","nextY","cursor","y","_moodEntries","recentEntries","index","date","dateStr","weekday","year","timeStr","toLocaleTimeString","narrative","generateEntryNarrative","splitTextToSize","parts","painCategory","push","toLowerCase","reliefMethods","notes","addPage","pageCount","getNumberOfPages","i","setPage","requiredSpace","level","save","filename","getDataURL"],"ignoreList":[],"sources":["../../src/services/ClinicalPDFExporter.ts"],"sourcesContent":["import autoTable from 'jspdf-autotable';\r\nimport type { jsPDF as jsPDFType } from 'jspdf';\r\nimport type { PainEntry, MoodEntry } from '../types/pain-tracker';\r\n\r\nconst getPainIntensity = (entry: PainEntry): number =>\r\n  entry.intensity ?? entry.baselineData?.pain ?? 0;\r\n\r\nconst getPainLocation = (entry: PainEntry): string | undefined =>\r\n  entry.location ?? entry.baselineData?.locations?.join(', ');\r\n\r\nconst getPainQuality = (entry: PainEntry): string[] =>\r\n  entry.quality ?? entry.baselineData?.symptoms ?? [];\r\n\r\ninterface PatientInfo {\r\n  name?: string;\r\n  dateOfBirth?: string;\r\n  patientId?: string;\r\n  claimNumber?: string; // WorkSafe BC\r\n  injuryDate?: string; // WorkSafe BC\r\n  physicianName?: string;\r\n  physicianPhone?: string;\r\n}\r\n\r\ninterface ChartDataURL {\r\n  painTrend?: string;\r\n  painDistribution?: string;\r\n  symptomFrequency?: string;\r\n}\r\n\r\ninterface PDFExportOptions {\r\n  patientInfo?: PatientInfo;\r\n  entries: PainEntry[];\r\n  moodEntries?: MoodEntry[];\r\n  dateRange?: { start: Date; end: Date };\r\n  charts?: ChartDataURL;\r\n  includeNarrative?: boolean;\r\n  wcbCompliant?: boolean; // WorkSafe BC specific formatting\r\n  clinicalNotes?: string;\r\n}\r\n\r\ninterface PDFMetadata {\r\n  title: string;\r\n  subject: string;\r\n  author: string;\r\n  keywords: string;\r\n  creator: string;\r\n}\r\n\r\n/**\r\n * Clinical PDF Exporter Service\r\n *\r\n * Generates comprehensive clinical reports with:\r\n * - WorkSafe BC compliance formatting\r\n * - Embedded charts and visualizations\r\n * - Narrative timeline with clinical context\r\n * - Statistical summaries and trend analysis\r\n * - HIPAA-compliant headers and footers\r\n */\r\nexport class ClinicalPDFExporter {\r\n  private doc: jsPDFType | null = null;\r\n\r\n  /**\r\n   * Dynamically import jsPDF and autoTable\r\n   */\r\n  private async initializePDF(): Promise<jsPDFType> {\r\n    if (this.doc) return this.doc;\r\n\r\n    const [{ default: jsPDF }, _] = await Promise.all([import('jspdf'), import('jspdf-autotable')]);\r\n\r\n    this.doc = new jsPDF();\r\n    return this.doc;\r\n  }\r\n  private pageWidth: number = 0;\r\n  private pageHeight: number = 0;\r\n  private margin = 20;\r\n  private currentY = 20;\r\n  private lineHeight = 7;\r\n  private readonly primaryColor = '#2563eb';\r\n  private readonly secondaryColor = '#64748b';\r\n  private readonly accentColor = '#10b981';\r\n\r\n  constructor() {\r\n    // Lazy initialization - doc created when needed\r\n  }\r\n\r\n  /**\r\n   * Generate a comprehensive clinical PDF report\r\n   */\r\n  async generateReport(options: PDFExportOptions): Promise<Blob> {\r\n    // Dynamically load jsPDF\r\n    await this.initializePDF();\r\n\r\n    this.pageWidth = this.doc!.internal.pageSize.getWidth();\r\n    this.pageHeight = this.doc!.internal.pageSize.getHeight();\r\n\r\n    this.setupMetadata(options);\r\n\r\n    // Header and patient info\r\n    this.addHeader(options.wcbCompliant || false);\r\n    this.addPatientInformation(options.patientInfo);\r\n\r\n    // Executive summary\r\n    this.addExecutiveSummary(options.entries, options.moodEntries);\r\n\r\n    // Charts and visualizations\r\n    if (options.charts) {\r\n      await this.addCharts(options.charts);\r\n    }\r\n\r\n    // Pain entry table\r\n    this.addPainEntryTable(options.entries, options.dateRange);\r\n\r\n    // Narrative timeline\r\n    if (options.includeNarrative) {\r\n      this.addNarrativeTimeline(options.entries, options.moodEntries);\r\n    }\r\n\r\n    // Clinical notes\r\n    if (options.clinicalNotes) {\r\n      this.addClinicalNotes(options.clinicalNotes);\r\n    }\r\n\r\n    // WorkSafe BC specific sections\r\n    if (options.wcbCompliant) {\r\n      this.addWCBComplianceSections(options.patientInfo);\r\n    }\r\n\r\n    // Footer on all pages\r\n    this.addFooters();\r\n\r\n    return this.doc!.output('blob');\r\n  }\r\n\r\n  /**\r\n   * Set PDF metadata for HIPAA compliance\r\n   */\r\n  private setupMetadata(options: PDFExportOptions): void {\r\n    const metadata: PDFMetadata = {\r\n      title: 'Clinical Pain Management Report',\r\n      subject: `Pain tracking report for ${options.dateRange?.start ? `${options.dateRange.start.toLocaleDateString()} to ${options.dateRange.end?.toLocaleDateString()}` : 'All time'}`,\r\n      author: options.patientInfo?.physicianName || 'Pain Tracker Clinical System',\r\n      keywords: 'pain management, clinical report, chronic pain, WorkSafe BC',\r\n      creator: 'Pain Tracker v3.0 - Clinical Module',\r\n    };\r\n\r\n    this.doc!.setProperties(metadata);\r\n  }\r\n\r\n  /**\r\n   * Add clinical header with branding and confidentiality notice\r\n   */\r\n  private addHeader(wcbCompliant: boolean): void {\r\n    // Logo/Branding area\r\n    this.doc!.setFontSize(20);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Clinical Pain Management Report', this.margin, this.currentY);\r\n\r\n    // Confidentiality notice\r\n    this.currentY += 10;\r\n    this.doc!.setFontSize(9);\r\n    this.doc!.setTextColor(200, 0, 0);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('CONFIDENTIAL MEDICAL RECORD', this.margin, this.currentY);\r\n\r\n    this.currentY += 5;\r\n    this.doc!.setFontSize(8);\r\n    this.doc!.setTextColor(this.secondaryColor);\r\n    this.doc!.setFont('helvetica', 'normal');\r\n    this.doc!.text(\r\n      'This document contains protected health information (PHI). Unauthorized disclosure is prohibited.',\r\n      this.margin,\r\n      this.currentY\r\n    );\r\n\r\n    if (wcbCompliant) {\r\n      this.currentY += 4;\r\n      this.doc!.setTextColor(this.primaryColor);\r\n      this.doc!.setFont('helvetica', 'bold');\r\n      this.doc!.text('WorkSafe BC Claim Documentation', this.margin, this.currentY);\r\n    }\r\n\r\n    // Date generated\r\n    this.doc!.setFontSize(9);\r\n    this.doc!.setTextColor(this.secondaryColor);\r\n    this.doc!.setFont('helvetica', 'normal');\r\n    this.doc!.text(\r\n      `Generated: ${new Date().toLocaleString()}`,\r\n      this.pageWidth - this.margin - 50,\r\n      20,\r\n      { align: 'right' }\r\n    );\r\n\r\n    // Divider line\r\n    this.currentY += 8;\r\n    this.doc!.setDrawColor(this.secondaryColor);\r\n    this.doc!.setLineWidth(0.5);\r\n    this.doc!.line(this.margin, this.currentY, this.pageWidth - this.margin, this.currentY);\r\n\r\n    this.currentY += 10;\r\n  }\r\n\r\n  /**\r\n   * Add patient demographics and claim information\r\n   */\r\n  private addPatientInformation(info?: PatientInfo): void {\r\n    if (!info) return;\r\n\r\n    this.checkPageBreak(40);\r\n\r\n    this.doc!.setFontSize(14);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Patient Information', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n    this.doc!.setFontSize(10);\r\n    this.doc!.setTextColor(0, 0, 0);\r\n    this.doc!.setFont('helvetica', 'normal');\r\n\r\n    const fields: Array<[string, string | undefined]> = [\r\n      ['Name:', info.name],\r\n      ['Date of Birth:', info.dateOfBirth],\r\n      ['Patient ID:', info.patientId],\r\n      ['Claim Number:', info.claimNumber],\r\n      ['Injury Date:', info.injuryDate],\r\n      ['Physician:', info.physicianName],\r\n      ['Physician Contact:', info.physicianPhone],\r\n    ];\r\n\r\n    fields.forEach(([label, value]) => {\r\n      if (value) {\r\n        this.doc!.setFont('helvetica', 'bold');\r\n        this.doc!.text(label, this.margin, this.currentY);\r\n        this.doc!.setFont('helvetica', 'normal');\r\n        this.doc!.text(value, this.margin + 45, this.currentY);\r\n        this.currentY += this.lineHeight;\r\n      }\r\n    });\r\n\r\n    this.currentY += 5;\r\n  }\r\n\r\n  /**\r\n   * Add executive summary with key metrics\r\n   */\r\n  private addExecutiveSummary(entries: PainEntry[], moodEntries?: MoodEntry[]): void {\r\n    this.checkPageBreak(60);\r\n\r\n    this.doc!.setFontSize(14);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Executive Summary', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n\r\n    // Calculate statistics\r\n    const avgPain = entries.reduce((sum, e) => sum + getPainIntensity(e), 0) / entries.length;\r\n    const maxPain = Math.max(...entries.map(getPainIntensity));\r\n    const minPain = Math.min(...entries.map(getPainIntensity));\r\n    const totalEntries = entries.length;\r\n\r\n    const dateRange =\r\n      entries.length > 0\r\n        ? `${new Date(entries[0].timestamp).toLocaleDateString()} to ${new Date(entries[entries.length - 1].timestamp).toLocaleDateString()}`\r\n        : 'No data';\r\n\r\n    // Summary box\r\n    this.doc!.setFillColor(245, 247, 250);\r\n    this.doc!.rect(this.margin, this.currentY - 5, this.pageWidth - 2 * this.margin, 45, 'F');\r\n\r\n    this.doc!.setFontSize(10);\r\n    this.doc!.setTextColor(0, 0, 0);\r\n\r\n    const summaryData = [\r\n      ['Reporting Period:', dateRange],\r\n      ['Total Pain Entries:', `${totalEntries} recordings`],\r\n      ['Average Pain Level:', `${avgPain.toFixed(1)}/10 (${this.getPainCategory(avgPain)})`],\r\n      ['Pain Range:', `${minPain} - ${maxPain}/10`],\r\n      ['Mood Entries:', moodEntries ? `${moodEntries.length} recordings` : 'N/A'],\r\n    ];\r\n\r\n    summaryData.forEach(([label, value]) => {\r\n      this.doc!.setFont('helvetica', 'bold');\r\n      this.doc!.text(label, this.margin + 5, this.currentY);\r\n      this.doc!.setFont('helvetica', 'normal');\r\n      this.doc!.text(value, this.margin + 55, this.currentY);\r\n      this.currentY += this.lineHeight;\r\n    });\r\n\r\n    this.currentY += 8;\r\n  }\r\n\r\n  /**\r\n   * Embed chart images from canvas data URLs\r\n   */\r\n  private async addCharts(charts: ChartDataURL): Promise<void> {\r\n    this.checkPageBreak(120);\r\n\r\n    this.doc!.setFontSize(14);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Pain Trend Analysis', this.margin, this.currentY);\r\n\r\n    this.currentY += 10;\r\n\r\n    const chartWidth = this.pageWidth - 2 * this.margin;\r\n    const chartHeight = 60;\r\n\r\n    if (charts.painTrend) {\r\n      try {\r\n        this.doc!.addImage(\r\n          charts.painTrend,\r\n          'PNG',\r\n          this.margin,\r\n          this.currentY,\r\n          chartWidth,\r\n          chartHeight\r\n        );\r\n        this.currentY += chartHeight + 5;\r\n\r\n        this.doc!.setFontSize(9);\r\n        this.doc!.setTextColor(this.secondaryColor);\r\n        this.doc!.text(\r\n          'Figure 1: Pain intensity trends over reporting period',\r\n          this.margin,\r\n          this.currentY\r\n        );\r\n        this.currentY += 10;\r\n      } catch (error) {\r\n        console.error('Failed to embed pain trend chart:', error);\r\n      }\r\n    }\r\n\r\n    this.checkPageBreak(80);\r\n\r\n    if (charts.painDistribution) {\r\n      try {\r\n        this.doc!.addImage(\r\n          charts.painDistribution,\r\n          'PNG',\r\n          this.margin,\r\n          this.currentY,\r\n          chartWidth,\r\n          chartHeight\r\n        );\r\n        this.currentY += chartHeight + 5;\r\n\r\n        this.doc!.setFontSize(9);\r\n        this.doc!.setTextColor(this.secondaryColor);\r\n        this.doc!.text(\r\n          'Figure 2: Pain level distribution and frequency analysis',\r\n          this.margin,\r\n          this.currentY\r\n        );\r\n        this.currentY += 10;\r\n      } catch (error) {\r\n        console.error('Failed to embed pain distribution chart:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add detailed pain entry table\r\n   */\r\n  private addPainEntryTable(entries: PainEntry[], dateRange?: { start: Date; end: Date }): void {\r\n    this.checkPageBreak(40);\r\n\r\n    this.doc!.setFontSize(14);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Detailed Pain Log', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n\r\n    // Filter entries by date range if provided\r\n    let filteredEntries = entries;\r\n    if (dateRange) {\r\n      filteredEntries = entries.filter(entry => {\r\n        const entryDate = new Date(entry.timestamp);\r\n        return entryDate >= dateRange.start && entryDate <= dateRange.end;\r\n      });\r\n    }\r\n\r\n    // Prepare table data\r\n    const tableData = filteredEntries.slice(0, 50).map(entry => [\r\n      new Date(entry.timestamp).toLocaleString('en-US', {\r\n        month: 'short',\r\n        day: 'numeric',\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n      }),\r\n      getPainIntensity(entry).toString(),\r\n      getPainLocation(entry) || 'Not specified',\r\n      getPainQuality(entry).join(', ') || 'N/A',\r\n      entry.triggers?.join(', ') || 'None noted',\r\n    ]);\r\n\r\n    autoTable(this.doc, {\r\n      startY: this.currentY,\r\n      head: [['Date/Time', 'Level', 'Location', 'Quality', 'Triggers']],\r\n      body: tableData,\r\n      theme: 'striped',\r\n      headStyles: {\r\n        fillColor: [37, 99, 235], // Primary color\r\n        textColor: 255,\r\n        fontSize: 9,\r\n        fontStyle: 'bold',\r\n      },\r\n      bodyStyles: {\r\n        fontSize: 8,\r\n        textColor: [0, 0, 0],\r\n      },\r\n      alternateRowStyles: {\r\n        fillColor: [249, 250, 251],\r\n      },\r\n      margin: { left: this.margin, right: this.margin },\r\n      didDrawPage: (data: unknown) => {\r\n        const nextY = (() => {\r\n          if (typeof data !== 'object' || data === null) return undefined;\r\n          const cursor = (data as { cursor?: unknown }).cursor;\r\n          if (typeof cursor !== 'object' || cursor === null) return undefined;\r\n          const y = (cursor as { y?: unknown }).y;\r\n          return typeof y === 'number' ? y : undefined;\r\n        })();\r\n\r\n        this.currentY = nextY ?? this.currentY;\r\n      },\r\n    });\r\n\r\n    this.currentY += 10;\r\n\r\n    if (filteredEntries.length > 50) {\r\n      this.doc!.setFontSize(9);\r\n      this.doc!.setTextColor(this.secondaryColor);\r\n      this.doc!.text(\r\n        `Note: Showing most recent 50 of ${filteredEntries.length} total entries`,\r\n        this.margin,\r\n        this.currentY\r\n      );\r\n      this.currentY += 10;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Add narrative clinical timeline\r\n   */\r\n  private addNarrativeTimeline(entries: PainEntry[], _moodEntries?: MoodEntry[]): void {\r\n    this.checkPageBreak(40);\r\n\r\n    this.doc!.setFontSize(14);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Clinical Narrative Timeline', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n\r\n    // Generate narrative from entries\r\n    const recentEntries = entries.slice(-10);\r\n\r\n    recentEntries.forEach((entry, index) => {\r\n      this.checkPageBreak(30);\r\n\r\n      const date = new Date(entry.timestamp);\r\n      const dateStr = date.toLocaleDateString('en-US', {\r\n        weekday: 'short',\r\n        month: 'short',\r\n        day: 'numeric',\r\n        year: 'numeric',\r\n      });\r\n      const timeStr = date.toLocaleTimeString('en-US', {\r\n        hour: '2-digit',\r\n        minute: '2-digit',\r\n      });\r\n\r\n      // Date header\r\n      this.doc!.setFontSize(10);\r\n      this.doc!.setTextColor(this.primaryColor);\r\n      this.doc!.setFont('helvetica', 'bold');\r\n      this.doc!.text(`${dateStr} at ${timeStr}`, this.margin, this.currentY);\r\n\r\n      this.currentY += 6;\r\n\r\n      // Narrative text\r\n      this.doc!.setFontSize(9);\r\n      this.doc!.setTextColor(0, 0, 0);\r\n      this.doc!.setFont('helvetica', 'normal');\r\n\r\n      const narrative = this.generateEntryNarrative(entry);\r\n      const lines = this.doc!.splitTextToSize(narrative, this.pageWidth - 2 * this.margin - 10);\r\n\r\n      lines.forEach((line: string) => {\r\n        this.checkPageBreak(10);\r\n        this.doc!.text(line, this.margin + 5, this.currentY);\r\n        this.currentY += 5;\r\n      });\r\n\r\n      this.currentY += 3;\r\n\r\n      // Divider\r\n      if (index < recentEntries.length - 1) {\r\n        this.doc!.setDrawColor(220, 220, 220);\r\n        this.doc!.setLineWidth(0.3);\r\n        this.doc!.line(\r\n          this.margin + 5,\r\n          this.currentY,\r\n          this.pageWidth - this.margin - 5,\r\n          this.currentY\r\n        );\r\n        this.currentY += 5;\r\n      }\r\n    });\r\n\r\n    this.currentY += 5;\r\n  }\r\n\r\n  /**\r\n   * Generate narrative text from pain entry\r\n   */\r\n  private generateEntryNarrative(entry: PainEntry): string {\r\n    const parts: string[] = [];\r\n\r\n    // Pain intensity\r\n    const intensity = getPainIntensity(entry);\r\n    const painCategory = this.getPainCategory(intensity);\r\n    parts.push(`Patient reported ${painCategory.toLowerCase()} pain (${intensity}/10)`);\r\n\r\n    // Location\r\n    const location = getPainLocation(entry);\r\n    if (location) {\r\n      parts.push(`in ${location}`);\r\n    }\r\n\r\n    // Quality descriptors\r\n    const quality = getPainQuality(entry);\r\n    if (quality.length > 0) {\r\n      parts.push(`described as ${quality.join(', ')}`);\r\n    }\r\n\r\n    // Triggers\r\n    if (entry.triggers && entry.triggers.length > 0) {\r\n      parts.push(`Triggers identified: ${entry.triggers.join(', ')}`);\r\n    }\r\n\r\n    // Relief methods\r\n    if (entry.reliefMethods && entry.reliefMethods.length > 0) {\r\n      parts.push(`Relief attempted with: ${entry.reliefMethods.join(', ')}`);\r\n    }\r\n\r\n    // Notes\r\n    if (entry.notes) {\r\n      parts.push(`Additional notes: \"${entry.notes}\"`);\r\n    }\r\n\r\n    return parts.join('. ') + '.';\r\n  }\r\n\r\n  /**\r\n   * Add clinical notes section\r\n   */\r\n  private addClinicalNotes(notes: string): void {\r\n    this.checkPageBreak(40);\r\n\r\n    this.doc!.setFontSize(14);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Clinical Notes & Observations', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n\r\n    this.doc!.setFontSize(10);\r\n    this.doc!.setTextColor(0, 0, 0);\r\n    this.doc!.setFont('helvetica', 'normal');\r\n\r\n    const lines = this.doc!.splitTextToSize(notes, this.pageWidth - 2 * this.margin);\r\n\r\n    lines.forEach((line: string) => {\r\n      this.checkPageBreak(10);\r\n      this.doc!.text(line, this.margin, this.currentY);\r\n      this.currentY += this.lineHeight;\r\n    });\r\n\r\n    this.currentY += 5;\r\n  }\r\n\r\n  /**\r\n   * Add WorkSafe BC compliance sections\r\n   */\r\n  private addWCBComplianceSections(info?: PatientInfo): void {\r\n    // Add new page for WCB declaration\r\n    this.doc!.addPage();\r\n    this.currentY = this.margin;\r\n\r\n    this.doc!.setFontSize(16);\r\n    this.doc!.setTextColor(this.primaryColor);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('WorkSafe BC Claim Documentation', this.margin, this.currentY);\r\n\r\n    this.currentY += 12;\r\n\r\n    // Claim information summary\r\n    this.doc!.setFontSize(12);\r\n    this.doc!.text('Claim Information', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n    this.doc!.setFontSize(10);\r\n    this.doc!.setFont('helvetica', 'normal');\r\n\r\n    if (info?.claimNumber) {\r\n      this.doc!.text(`Claim Number: ${info.claimNumber}`, this.margin, this.currentY);\r\n      this.currentY += this.lineHeight;\r\n    }\r\n\r\n    if (info?.injuryDate) {\r\n      this.doc!.text(`Date of Injury: ${info.injuryDate}`, this.margin, this.currentY);\r\n      this.currentY += this.lineHeight;\r\n    }\r\n\r\n    this.currentY += 10;\r\n\r\n    // Declaration statement\r\n    this.doc!.setFontSize(12);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('Medical Professional Declaration', this.margin, this.currentY);\r\n\r\n    this.currentY += 8;\r\n    this.doc!.setFontSize(9);\r\n    this.doc!.setFont('helvetica', 'normal');\r\n\r\n    const declaration =\r\n      'I declare that the information contained in this report is true and accurate to the best of my ' +\r\n      'knowledge and belief. This clinical documentation has been prepared in accordance with WorkSafe BC ' +\r\n      'requirements and medical reporting standards. The patient data presented represents objective clinical ' +\r\n      'observations and patient-reported outcomes collected during the reporting period.';\r\n\r\n    const declarationLines = this.doc!.splitTextToSize(\r\n      declaration,\r\n      this.pageWidth - 2 * this.margin\r\n    );\r\n\r\n    declarationLines.forEach((line: string) => {\r\n      this.doc!.text(line, this.margin, this.currentY);\r\n      this.currentY += 6;\r\n    });\r\n\r\n    this.currentY += 15;\r\n\r\n    // Signature fields\r\n    this.doc!.setDrawColor(0, 0, 0);\r\n    this.doc!.setLineWidth(0.5);\r\n\r\n    // Physician signature\r\n    this.doc!.line(this.margin, this.currentY, this.margin + 80, this.currentY);\r\n    this.currentY += 5;\r\n    this.doc!.setFontSize(9);\r\n    this.doc!.text('Physician Signature', this.margin, this.currentY);\r\n\r\n    // Date\r\n    this.doc!.line(\r\n      this.pageWidth - this.margin - 50,\r\n      this.currentY - 5,\r\n      this.pageWidth - this.margin,\r\n      this.currentY - 5\r\n    );\r\n    this.doc!.text('Date', this.pageWidth - this.margin - 50, this.currentY);\r\n\r\n    this.currentY += 15;\r\n\r\n    if (info?.physicianName) {\r\n      this.doc!.text(`Printed Name: ${info.physicianName}`, this.margin, this.currentY);\r\n      this.currentY += this.lineHeight;\r\n    }\r\n\r\n    if (info?.physicianPhone) {\r\n      this.doc!.text(`Contact: ${info.physicianPhone}`, this.margin, this.currentY);\r\n      this.currentY += this.lineHeight;\r\n    }\r\n\r\n    // Compliance notice\r\n    this.currentY += 15;\r\n    this.doc!.setFillColor(255, 250, 230);\r\n    this.doc!.rect(this.margin, this.currentY - 5, this.pageWidth - 2 * this.margin, 25, 'F');\r\n\r\n    this.doc!.setFontSize(8);\r\n    this.doc!.setTextColor(100, 100, 0);\r\n    this.doc!.setFont('helvetica', 'bold');\r\n    this.doc!.text('WorkSafe BC Notice:', this.margin + 5, this.currentY);\r\n\r\n    this.currentY += 5;\r\n    this.doc!.setFont('helvetica', 'normal');\r\n    this.doc!.setTextColor(0, 0, 0);\r\n\r\n    const noticeText =\r\n      'This report is submitted in support of a WorkSafe BC claim. The information provided is for the ' +\r\n      \"purpose of assessing and managing the claimant's work-related injury or illness. Any questions \" +\r\n      'regarding this documentation should be directed to the attending physician.';\r\n\r\n    const noticeLines = this.doc!.splitTextToSize(\r\n      noticeText,\r\n      this.pageWidth - 2 * this.margin - 10\r\n    );\r\n\r\n    noticeLines.forEach((line: string) => {\r\n      this.doc!.text(line, this.margin + 5, this.currentY);\r\n      this.currentY += 5;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add footer to all pages\r\n   */\r\n  private addFooters(): void {\r\n    const pageCount = this.doc!.getNumberOfPages();\r\n\r\n    for (let i = 1; i <= pageCount; i++) {\r\n      this.doc!.setPage(i);\r\n\r\n      // Footer line\r\n      this.doc!.setDrawColor(this.secondaryColor);\r\n      this.doc!.setLineWidth(0.3);\r\n      this.doc!.line(\r\n        this.margin,\r\n        this.pageHeight - 15,\r\n        this.pageWidth - this.margin,\r\n        this.pageHeight - 15\r\n      );\r\n\r\n      // Footer text\r\n      this.doc!.setFontSize(8);\r\n      this.doc!.setTextColor(this.secondaryColor);\r\n      this.doc!.setFont('helvetica', 'normal');\r\n\r\n      // Left: Confidentiality\r\n      this.doc!.text(\r\n        'Confidential Medical Record - Do Not Distribute',\r\n        this.margin,\r\n        this.pageHeight - 10\r\n      );\r\n\r\n      // Center: Generated by\r\n      this.doc!.text(\r\n        'Pain Tracker Clinical System v3.0',\r\n        this.pageWidth / 2,\r\n        this.pageHeight - 10,\r\n        { align: 'center' }\r\n      );\r\n\r\n      // Right: Page number\r\n      this.doc!.text(\r\n        `Page ${i} of ${pageCount}`,\r\n        this.pageWidth - this.margin,\r\n        this.pageHeight - 10,\r\n        { align: 'right' }\r\n      );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if we need a page break\r\n   */\r\n  private checkPageBreak(requiredSpace: number): void {\r\n    if (this.currentY + requiredSpace > this.pageHeight - 25) {\r\n      this.doc!.addPage();\r\n      this.currentY = this.margin;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Categorize pain level\r\n   */\r\n  private getPainCategory(level: number): string {\r\n    if (level === 0) return 'No Pain';\r\n    if (level <= 3) return 'Mild Pain';\r\n    if (level <= 6) return 'Moderate Pain';\r\n    if (level <= 8) return 'Severe Pain';\r\n    return 'Extreme Pain';\r\n  }\r\n\r\n  /**\r\n   * Save PDF to file\r\n   */\r\n  save(filename: string): void {\r\n    this.doc!.save(filename);\r\n  }\r\n\r\n  /**\r\n   * Get PDF as data URL\r\n   */\r\n  getDataURL(): string {\r\n    return this.doc!.output('dataurlstring');\r\n  }\r\n}\r\n\r\n/**\r\n * Helper function to capture chart as data URL\r\n */\r\nexport async function captureChartAsDataURL(canvasElement: HTMLCanvasElement): Promise<string> {\r\n  return canvasElement.toDataURL('image/png', 1.0);\r\n}\r\n\r\n/**\r\n * Quick export function for common use case\r\n */\r\nexport async function exportClinicalPDF(\r\n  entries: PainEntry[],\r\n  options?: Partial<PDFExportOptions>\r\n): Promise<Blob> {\r\n  const exporter = new ClinicalPDFExporter();\r\n  return exporter.generateReport({\r\n    entries,\r\n    ...options,\r\n  });\r\n}\r\n"],"file":"ClinicalPDFExporter-COWhgg-f.js"}