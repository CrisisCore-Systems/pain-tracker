import{E as t}from"./pdf-vendor-zZbfvrDE.js";import{l as e}from"./index-B7vNx0HN.js";import"./react-vendor-CM2d6bHp.js";import"./chart-vendor-C6dKBweC.js";import"./state-vendor-gOFTyJpA.js";import"./icons-vendor-DZ-9b690.js";import"./date-vendor-Bi3xipBn.js";import"./i18n-vendor-C-xkjauL.js";class o{doc;options;constructor(e){this.doc=new t,this.options=e}async generate(){return this.addHeader(),this.addSummary(),this.addDetailedSections(),this.options.includeRawData&&this.addRawData(),this.addFooter(),this.doc.output("blob")}addHeader(){const{template:t,dateRange:e}=this.options;this.doc.setFontSize(20),this.doc.setFont("helvetica","bold"),this.doc.text("Pain Tracker Report",20,30),this.doc.setFontSize(14),this.doc.setFont("helvetica","normal"),this.doc.text(t.name,20,45),this.doc.setFontSize(10),this.doc.text(`Period: ${new Date(e.start).toLocaleDateString()} - ${new Date(e.end).toLocaleDateString()}`,20,55),this.doc.text(`Generated: ${(new Date).toLocaleDateString()} ${(new Date).toLocaleTimeString()}`,20,62),this.doc.line(20,70,190,70)}addSummary(){const{entries:t,dateRange:o}=this.options,a=t.filter(t=>{const e=new Date(t.timestamp),a=new Date(o.start),s=new Date(o.end);return e>=a&&e<=s});this.doc.setFontSize(16),this.doc.setFont("helvetica","bold"),this.doc.text("Summary",20,85),this.doc.setFontSize(12),this.doc.setFont("helvetica","normal");let s=95;const n=a.length>0?a.reduce((t,e)=>t+e.baselineData.pain,0)/a.length:0,i=this.getMostCommon(a.flatMap(t=>t.baselineData.locations||[])),r=this.getMostCommon(a.flatMap(t=>t.baselineData.symptoms||[]));this.doc.text(`Total Entries: ${a.length}`,20,s),s+=8,this.doc.text(`Average Pain Level: ${e(n,1)}/10`,20,s),s+=8,this.doc.text(`Most Common Location: ${i}`,20,s),s+=8,this.doc.text(`Most Common Symptom: ${r}`,20,s),s+=8;const c=this.getPainDistribution(a);this.doc.text("Pain Level Distribution:",20,s+5),s+=15,Object.entries(c).forEach(([t,e])=>{this.doc.text(`Level ${t}: ${e} entries`,30,s),s+=6})}addDetailedSections(){const{template:t,entries:e,dateRange:o}=this.options;let a=160;t.sections.forEach(t=>{const s=t;switch(a>250&&(this.doc.addPage(),a=30),this.doc.setFontSize(14),this.doc.setFont("helvetica","bold"),this.doc.text(s.title,20,a),a+=10,this.doc.setFontSize(10),this.doc.setFont("helvetica","normal"),s.type){case"metrics":a=this.addMetricsSection(s,e,o,a);break;case"table":a=this.addTableSection(s,e,o,a);break;case"text":a=this.addTextSection(s,e,o,a);break;default:this.doc.text(`[Chart: ${s.dataSource}]`,20,a),a+=10}a+=15})}addMetricsSection(t,o,a,s){const n=o.filter(t=>{const e=new Date(t.timestamp),o=new Date(a.start),s=new Date(a.end);return e>=o&&e<=s});switch(t.dataSource){case"medications":{const t=new Set(n.flatMap(t=>t.medications?.current?.map(t=>t.name)||[]));this.doc.text(`Total Unique Medications: ${t.size}`,20,s),s+=8,Array.from(t).slice(0,5).forEach(t=>{this.doc.text(`â€¢ ${t}`,30,s),s+=6});break}case"progress":{const t=n.length>0?n.reduce((t,e)=>t+e.baselineData.pain,0)/n.length:0;this.doc.text(`Average Pain Level: ${e(t,1)}/10`,20,s),s+=8,this.doc.text(`Total Entries: ${n.length}`,20,s),s+=8;break}}return s}addTableSection(t,e,o,a){const s=e.filter(t=>{const e=new Date(t.timestamp),a=new Date(o.start),s=new Date(o.end);return e>=a&&e<=s});switch(t.dataSource){case"symptoms":{const t=this.getSymptomCounts(s),e=Object.entries(t).sort(([,t],[,e])=>e-t).slice(0,10);if(e.length>0){const t=e.map(([t,e])=>[t,e.toString()]);this.doc.autoTable({startY:a,head:[["Symptom","Frequency"]],body:t,margin:{left:20},styles:{fontSize:8},headStyles:{fillColor:[66,139,202]}}),a=(this.doc.lastAutoTable?.finalY??a)+10}break}}return a}addTextSection(t,e,o,a){const s=e.filter(t=>{const e=new Date(t.timestamp),a=new Date(o.start),s=new Date(o.end);return e>=a&&e<=s});switch(t.dataSource){case"overview":this.doc.text(`Report covers ${s.length} pain entries from ${new Date(o.start).toLocaleDateString()} to ${new Date(o.end).toLocaleDateString()}.`,20,a),a+=8;break;case"treatments":{const t=new Set(s.flatMap(t=>t.treatments?.recent?.map(t=>t.type)||[]));this.doc.text(`Treatments received: ${Array.from(t).join(", ")}`,20,a),a+=8;break}}return a}addRawData(){const{entries:t,dateRange:e}=this.options;this.doc.addPage(),this.doc.setFontSize(16),this.doc.setFont("helvetica","bold"),this.doc.text("Raw Data",20,30);const o=t.filter(t=>{const o=new Date(t.timestamp),a=new Date(e.start),s=new Date(e.end);return o>=a&&o<=s}).map(t=>[new Date(t.timestamp).toLocaleDateString(),t.baselineData.pain.toString(),(t.baselineData.locations||[]).join(", "),(t.baselineData.symptoms||[]).join(", "),(t.notes||"").substring(0,50)+((t.notes||"").length>50?"...":"")]);this.doc.autoTable({startY:40,head:[["Date","Pain Level","Locations","Symptoms","Notes"]],body:o,margin:{left:20,right:20},styles:{fontSize:7},headStyles:{fillColor:[66,139,202]},columnStyles:{0:{cellWidth:25},1:{cellWidth:20},2:{cellWidth:35},3:{cellWidth:35},4:{cellWidth:55}}})}addFooter(){const t=this.doc.getNumberOfPages();for(let e=1;e<=t;e++)this.doc.setPage(e),this.doc.setFontSize(8),this.doc.setFont("helvetica","normal"),this.doc.text(`Page ${e} of ${t} - Generated by Pain Tracker Pro`,20,this.doc.internal.pageSize.height-10)}getMostCommon(t){if(0===t.length)return"None";const e=t.reduce((t,e)=>(t[e]=(t[e]||0)+1,t),{});return Object.entries(e).sort(([,t],[,e])=>e-t)[0][0]}getPainDistribution(t){const e={};return t.forEach(t=>{const o=t.baselineData.pain.toString();e[o]=(e[o]||0)+1}),e}getSymptomCounts(t){const e={};return t.forEach(t=>{(t.baselineData.symptoms||[]).forEach(t=>{e[t]=(e[t]||0)+1})}),e}}async function a(t){return new o(t).generate()}export{o as PDFReportGenerator,a as generatePDFReport};
