import{_ as t,b as i}from"./pdf-vendor-zZbfvrDE.js";const e=t=>t.intensity??t.baselineData?.pain??0,s=t=>t.location??t.baselineData?.locations?.join(", "),r=t=>t.quality??t.baselineData?.symptoms??[];class o{doc=null;async initializePDF(){if(this.doc)return this.doc;const[{default:i},e]=await Promise.all([t(()=>import("./pdf-vendor-zZbfvrDE.js").then(t=>t.j),[]),t(()=>import("./pdf-vendor-zZbfvrDE.js").then(t=>t.c),[])]);return this.doc=new i,this.doc}pageWidth=0;pageHeight=0;margin=20;currentY=20;lineHeight=7;primaryColor="#2563eb";secondaryColor="#64748b";accentColor="#10b981";constructor(){}async generateReport(t){return await this.initializePDF(),this.pageWidth=this.doc.internal.pageSize.getWidth(),this.pageHeight=this.doc.internal.pageSize.getHeight(),this.setupMetadata(t),this.addHeader(t.wcbCompliant||!1),this.addPatientInformation(t.patientInfo),this.addExecutiveSummary(t.entries,t.moodEntries),t.charts&&await this.addCharts(t.charts),this.addPainEntryTable(t.entries,t.dateRange),t.includeNarrative&&this.addNarrativeTimeline(t.entries,t.moodEntries),t.clinicalNotes&&this.addClinicalNotes(t.clinicalNotes),t.wcbCompliant&&this.addWCBComplianceSections(t.patientInfo),this.addFooters(),this.doc.output("blob")}setupMetadata(t){const i={title:"Clinical Pain Management Report",subject:"Pain tracking report for "+(t.dateRange?.start?`${t.dateRange.start.toLocaleDateString()} to ${t.dateRange.end?.toLocaleDateString()}`:"All time"),author:t.patientInfo?.physicianName||"Pain Tracker Clinical System",keywords:"pain management, clinical report, chronic pain, WorkSafe BC",creator:"Pain Tracker v3.0 - Clinical Module"};this.doc.setProperties(i)}addHeader(t){this.doc.setFontSize(20),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Clinical Pain Management Report",this.margin,this.currentY),this.currentY+=10,this.doc.setFontSize(9),this.doc.setTextColor(200,0,0),this.doc.setFont("helvetica","bold"),this.doc.text("CONFIDENTIAL MEDICAL RECORD",this.margin,this.currentY),this.currentY+=5,this.doc.setFontSize(8),this.doc.setTextColor(this.secondaryColor),this.doc.setFont("helvetica","normal"),this.doc.text("This document contains protected health information (PHI). Unauthorized disclosure is prohibited.",this.margin,this.currentY),t&&(this.currentY+=4,this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("WorkSafe BC Claim Documentation",this.margin,this.currentY)),this.doc.setFontSize(9),this.doc.setTextColor(this.secondaryColor),this.doc.setFont("helvetica","normal"),this.doc.text(`Generated: ${(new Date).toLocaleString()}`,this.pageWidth-this.margin-50,20,{align:"right"}),this.currentY+=8,this.doc.setDrawColor(this.secondaryColor),this.doc.setLineWidth(.5),this.doc.line(this.margin,this.currentY,this.pageWidth-this.margin,this.currentY),this.currentY+=10}addPatientInformation(t){if(!t)return;this.checkPageBreak(40),this.doc.setFontSize(14),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Patient Information",this.margin,this.currentY),this.currentY+=8,this.doc.setFontSize(10),this.doc.setTextColor(0,0,0),this.doc.setFont("helvetica","normal");[["Name:",t.name],["Date of Birth:",t.dateOfBirth],["Patient ID:",t.patientId],["Claim Number:",t.claimNumber],["Injury Date:",t.injuryDate],["Physician:",t.physicianName],["Physician Contact:",t.physicianPhone]].forEach(([t,i])=>{i&&(this.doc.setFont("helvetica","bold"),this.doc.text(t,this.margin,this.currentY),this.doc.setFont("helvetica","normal"),this.doc.text(i,this.margin+45,this.currentY),this.currentY+=this.lineHeight)}),this.currentY+=5}addExecutiveSummary(t,i){this.checkPageBreak(60),this.doc.setFontSize(14),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Executive Summary",this.margin,this.currentY),this.currentY+=8;const s=t.reduce((t,i)=>t+e(i),0)/t.length,r=Math.max(...t.map(e)),o=Math.min(...t.map(e)),n=t.length,h=t.length>0?`${new Date(t[0].timestamp).toLocaleDateString()} to ${new Date(t[t.length-1].timestamp).toLocaleDateString()}`:"No data";this.doc.setFillColor(245,247,250),this.doc.rect(this.margin,this.currentY-5,this.pageWidth-2*this.margin,45,"F"),this.doc.setFontSize(10),this.doc.setTextColor(0,0,0);[["Reporting Period:",h],["Total Pain Entries:",`${n} recordings`],["Average Pain Level:",`${s.toFixed(1)}/10 (${this.getPainCategory(s)})`],["Pain Range:",`${o} - ${r}/10`],["Mood Entries:",i?`${i.length} recordings`:"N/A"]].forEach(([t,i])=>{this.doc.setFont("helvetica","bold"),this.doc.text(t,this.margin+5,this.currentY),this.doc.setFont("helvetica","normal"),this.doc.text(i,this.margin+55,this.currentY),this.currentY+=this.lineHeight}),this.currentY+=8}async addCharts(t){this.checkPageBreak(120),this.doc.setFontSize(14),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Pain Trend Analysis",this.margin,this.currentY),this.currentY+=10;const i=this.pageWidth-2*this.margin;if(t.painTrend)try{this.doc.addImage(t.painTrend,"PNG",this.margin,this.currentY,i,60),this.currentY+=65,this.doc.setFontSize(9),this.doc.setTextColor(this.secondaryColor),this.doc.text("Figure 1: Pain intensity trends over reporting period",this.margin,this.currentY),this.currentY+=10}catch(e){}if(this.checkPageBreak(80),t.painDistribution)try{this.doc.addImage(t.painDistribution,"PNG",this.margin,this.currentY,i,60),this.currentY+=65,this.doc.setFontSize(9),this.doc.setTextColor(this.secondaryColor),this.doc.text("Figure 2: Pain level distribution and frequency analysis",this.margin,this.currentY),this.currentY+=10}catch(e){}}addPainEntryTable(t,o){this.checkPageBreak(40),this.doc.setFontSize(14),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Detailed Pain Log",this.margin,this.currentY),this.currentY+=8;let n=t;o&&(n=t.filter(t=>{const i=new Date(t.timestamp);return i>=o.start&&i<=o.end}));const h=n.slice(0,50).map(t=>[new Date(t.timestamp).toLocaleString("en-US",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),e(t).toString(),s(t)||"Not specified",r(t).join(", ")||"N/A",t.triggers?.join(", ")||"None noted"]);i(this.doc,{startY:this.currentY,head:[["Date/Time","Level","Location","Quality","Triggers"]],body:h,theme:"striped",headStyles:{fillColor:[37,99,235],textColor:255,fontSize:9,fontStyle:"bold"},bodyStyles:{fontSize:8,textColor:[0,0,0]},alternateRowStyles:{fillColor:[249,250,251]},margin:{left:this.margin,right:this.margin},didDrawPage:t=>{const i=(()=>{if("object"!=typeof t||null===t)return;const i=t.cursor;if("object"!=typeof i||null===i)return;const e=i.y;return"number"==typeof e?e:void 0})();this.currentY=i??this.currentY}}),this.currentY+=10,n.length>50&&(this.doc.setFontSize(9),this.doc.setTextColor(this.secondaryColor),this.doc.text(`Note: Showing most recent 50 of ${n.length} total entries`,this.margin,this.currentY),this.currentY+=10)}addNarrativeTimeline(t,i){this.checkPageBreak(40),this.doc.setFontSize(14),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Clinical Narrative Timeline",this.margin,this.currentY),this.currentY+=8;const e=t.slice(-10);e.forEach((t,i)=>{this.checkPageBreak(30);const s=new Date(t.timestamp),r=s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric",year:"numeric"}),o=s.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"});this.doc.setFontSize(10),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text(`${r} at ${o}`,this.margin,this.currentY),this.currentY+=6,this.doc.setFontSize(9),this.doc.setTextColor(0,0,0),this.doc.setFont("helvetica","normal");const n=this.generateEntryNarrative(t);this.doc.splitTextToSize(n,this.pageWidth-2*this.margin-10).forEach(t=>{this.checkPageBreak(10),this.doc.text(t,this.margin+5,this.currentY),this.currentY+=5}),this.currentY+=3,i<e.length-1&&(this.doc.setDrawColor(220,220,220),this.doc.setLineWidth(.3),this.doc.line(this.margin+5,this.currentY,this.pageWidth-this.margin-5,this.currentY),this.currentY+=5)}),this.currentY+=5}generateEntryNarrative(t){const i=[],o=e(t),n=this.getPainCategory(o);i.push(`Patient reported ${n.toLowerCase()} pain (${o}/10)`);const h=s(t);h&&i.push(`in ${h}`);const a=r(t);return a.length>0&&i.push(`described as ${a.join(", ")}`),t.triggers&&t.triggers.length>0&&i.push(`Triggers identified: ${t.triggers.join(", ")}`),t.reliefMethods&&t.reliefMethods.length>0&&i.push(`Relief attempted with: ${t.reliefMethods.join(", ")}`),t.notes&&i.push(`Additional notes: "${t.notes}"`),i.join(". ")+"."}addClinicalNotes(t){this.checkPageBreak(40),this.doc.setFontSize(14),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("Clinical Notes & Observations",this.margin,this.currentY),this.currentY+=8,this.doc.setFontSize(10),this.doc.setTextColor(0,0,0),this.doc.setFont("helvetica","normal");this.doc.splitTextToSize(t,this.pageWidth-2*this.margin).forEach(t=>{this.checkPageBreak(10),this.doc.text(t,this.margin,this.currentY),this.currentY+=this.lineHeight}),this.currentY+=5}addWCBComplianceSections(t){this.doc.addPage(),this.currentY=this.margin,this.doc.setFontSize(16),this.doc.setTextColor(this.primaryColor),this.doc.setFont("helvetica","bold"),this.doc.text("WorkSafe BC Claim Documentation",this.margin,this.currentY),this.currentY+=12,this.doc.setFontSize(12),this.doc.text("Claim Information",this.margin,this.currentY),this.currentY+=8,this.doc.setFontSize(10),this.doc.setFont("helvetica","normal"),t?.claimNumber&&(this.doc.text(`Claim Number: ${t.claimNumber}`,this.margin,this.currentY),this.currentY+=this.lineHeight),t?.injuryDate&&(this.doc.text(`Date of Injury: ${t.injuryDate}`,this.margin,this.currentY),this.currentY+=this.lineHeight),this.currentY+=10,this.doc.setFontSize(12),this.doc.setFont("helvetica","bold"),this.doc.text("Medical Professional Declaration",this.margin,this.currentY),this.currentY+=8,this.doc.setFontSize(9),this.doc.setFont("helvetica","normal");this.doc.splitTextToSize("I declare that the information contained in this report is true and accurate to the best of my knowledge and belief. This clinical documentation has been prepared in accordance with WorkSafe BC requirements and medical reporting standards. The patient data presented represents objective clinical observations and patient-reported outcomes collected during the reporting period.",this.pageWidth-2*this.margin).forEach(t=>{this.doc.text(t,this.margin,this.currentY),this.currentY+=6}),this.currentY+=15,this.doc.setDrawColor(0,0,0),this.doc.setLineWidth(.5),this.doc.line(this.margin,this.currentY,this.margin+80,this.currentY),this.currentY+=5,this.doc.setFontSize(9),this.doc.text("Physician Signature",this.margin,this.currentY),this.doc.line(this.pageWidth-this.margin-50,this.currentY-5,this.pageWidth-this.margin,this.currentY-5),this.doc.text("Date",this.pageWidth-this.margin-50,this.currentY),this.currentY+=15,t?.physicianName&&(this.doc.text(`Printed Name: ${t.physicianName}`,this.margin,this.currentY),this.currentY+=this.lineHeight),t?.physicianPhone&&(this.doc.text(`Contact: ${t.physicianPhone}`,this.margin,this.currentY),this.currentY+=this.lineHeight),this.currentY+=15,this.doc.setFillColor(255,250,230),this.doc.rect(this.margin,this.currentY-5,this.pageWidth-2*this.margin,25,"F"),this.doc.setFontSize(8),this.doc.setTextColor(100,100,0),this.doc.setFont("helvetica","bold"),this.doc.text("WorkSafe BC Notice:",this.margin+5,this.currentY),this.currentY+=5,this.doc.setFont("helvetica","normal"),this.doc.setTextColor(0,0,0);this.doc.splitTextToSize("This report is submitted in support of a WorkSafe BC claim. The information provided is for the purpose of assessing and managing the claimant's work-related injury or illness. Any questions regarding this documentation should be directed to the attending physician.",this.pageWidth-2*this.margin-10).forEach(t=>{this.doc.text(t,this.margin+5,this.currentY),this.currentY+=5})}addFooters(){const t=this.doc.getNumberOfPages();for(let i=1;i<=t;i++)this.doc.setPage(i),this.doc.setDrawColor(this.secondaryColor),this.doc.setLineWidth(.3),this.doc.line(this.margin,this.pageHeight-15,this.pageWidth-this.margin,this.pageHeight-15),this.doc.setFontSize(8),this.doc.setTextColor(this.secondaryColor),this.doc.setFont("helvetica","normal"),this.doc.text("Confidential Medical Record - Do Not Distribute",this.margin,this.pageHeight-10),this.doc.text("Pain Tracker Clinical System v3.0",this.pageWidth/2,this.pageHeight-10,{align:"center"}),this.doc.text(`Page ${i} of ${t}`,this.pageWidth-this.margin,this.pageHeight-10,{align:"right"})}checkPageBreak(t){this.currentY+t>this.pageHeight-25&&(this.doc.addPage(),this.currentY=this.margin)}getPainCategory(t){return 0===t?"No Pain":t<=3?"Mild Pain":t<=6?"Moderate Pain":t<=8?"Severe Pain":"Extreme Pain"}save(t){this.doc.save(t)}getDataURL(){return this.doc.output("dataurlstring")}}export{o as ClinicalPDFExporter};
